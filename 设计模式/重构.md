# é‡æ„

å®é™…ä¸Šï¼Œä¼˜ç§€çš„ä»£ç éƒ½æ˜¯é‡æ„å‡ºæ¥çš„ï¼Œå¤æ‚çš„ä»£ç éƒ½æ˜¯æ…¢æ…¢å †ç Œå‡ºæ¥çš„ ã€‚æ‰€ä»¥ï¼Œå½“ä½ çœ‹åˆ°é‚£äº›ä¼˜ç§€è€Œå¤æ‚çš„å¼€æºä»£ç æ—¶ï¼Œä¸å¿…è‡ªæƒ­å½¢ç§½ã€‚

- é‡æ„æ˜¯ä»€ä¹ˆï¼ˆwhatï¼‰ï¼šé‡æ„æ˜¯ä¸€ç§å¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„æ”¹å–„ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶çš„å¯è§è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼Œä½¿å…¶æ›´æ˜“ç†è§£ï¼Œä¿®æ”¹æˆæœ¬æ›´ä½ã€‚

- ä¸ºä»€ä¹ˆè¦é‡æ„ï¼ˆwhyï¼‰ï¼šé‡æ„æ˜¯æ—¶åˆ»ä¿è¯ä»£ç è´¨é‡å¤„äºä¸€ä¸ªå¯æ§çŠ¶æ€çš„é‡è¦æ‰‹æ®µã€‚

- åˆ°åº•åœ¨é‡æ„ä»€ä¹ˆï¼ˆwhereï¼‰ï¼šæ ¹æ®é‡æ„çš„è§„æ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºï¼š
  - å¤§è§„æ¨¡é«˜å±‚æ¬¡é‡æ„ï¼šå¯¹ç³»ç»Ÿã€æ¨¡å—ã€ä»£ç ç»“æ„ã€ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ç­‰çš„é‡æ„ã€‚é‡æ„çš„æ‰‹æ®µæœ‰ï¼šåˆ†å±‚ã€æ¨¡å—åŒ–ã€è§£è€¦ã€æŠ½è±¡å¯å¤ç”¨ç»„ä»¶ç­‰ç­‰
  - å°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„ï¼šå¯¹ä»£ç ç»†èŠ‚çš„é‡æ„ï¼Œä¸»è¦æ˜¯é’ˆå¯¹ç±»ã€å‡½æ•°ã€å˜é‡ç­‰ä»£ç çº§åˆ«çš„é‡æ„ã€‚ç¼–ç è§„èŒƒå°±æ˜¯å°è§„æ¨¡é‡æ„çš„æ‰‹æ®µã€‚
  
- ä»€ä¹ˆæ—¶å€™é‡æ„ï¼ˆwhenï¼‰ï¼šé›†ä¸­é‡æ„è§£å†³æ‰€æœ‰é—®é¢˜æ˜¯ä¸ç°å®çš„ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥**å¯æŒç»­ã€å¯æ¼”è¿›**çš„æ–¹å¼æ¥é‡æ„ã€‚ä¸€å®šè¦å»ºç«‹æŒç»­é‡æ„æ„è¯†ï¼ŒæŠŠé‡æ„ä½œä¸ºå¼€å‘å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚

- å¦‚ä½•é‡æ„ï¼ˆhowï¼‰ï¼š
  - å¯¹äºå¤§å‹é‡æ„æ¥è¯´ï¼Œæ¶‰åŠçš„æ¨¡å—ã€ä»£ç æ¯”è¾ƒå¤šï¼Œå¯èƒ½è€¦åˆåº¦è¿˜é«˜ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œå¤§å‹é‡æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦æå‰åšå¥½å®Œå–„çš„é‡æ„è®¡åˆ’ï¼Œåˆ†é˜¶æ®µæ¥è¿›è¡Œå°èŒƒå›´çš„é‡æ„ã€‚é‡æ„åä¸€å®šè¦è¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿é‡æ„ä»£ç çš„æ­£ç¡®æ€§ã€‚å¿…è¦çš„æ—¶å€™è¿˜éœ€è¦å†™ä¸€äº›å…¼å®¹è¿‡æ¸¡ä»£ç ã€‚
  
    è¿™æ ·é‡æ„æ‰€éœ€çš„æ—¶é—´æ‰èƒ½æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ï¼ˆä¸€å¤©ï¼‰ï¼Œé¿å…å’Œæ–°åŠŸèƒ½çš„å¼€å‘å†²çªã€‚
  
  - å¯¹äºå°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„ï¼Œåªè¦ä½ æ„¿æ„ï¼Œéšæ—¶éƒ½å¯ä»¥å»åšã€‚
  
  æˆ‘ä»¬è¿™é‡Œå¹¶æœªç»™å‡ºå…·ä½“çš„é‡æ„æ–¹æ¡ˆã€‚



## å•å…ƒæµ‹è¯•



- **å•å…ƒæµ‹è¯•ï¼ˆUnit Testingï¼‰**çš„æµ‹è¯•å¯¹è±¡æ˜¯ç±»æˆ–è€…å‡½æ•°ï¼Œç”¨æ¥æµ‹è¯•ä¸€ä¸ªç±»å’Œå‡½æ•°æ˜¯å¦éƒ½æŒ‰ç…§é¢„æœŸçš„é€»è¾‘æ‰§è¡Œã€‚
- å•å…ƒæµ‹è¯•ç›¸å¯¹äº**é›†æˆæµ‹è¯•ï¼ˆIntegration Testingï¼‰**æ¥è¯´ï¼Œæµ‹è¯•çš„ç²’åº¦æ›´å°ä¸€äº›ã€‚é›†æˆæµ‹è¯•çš„æµ‹è¯•å¯¹è±¡æ˜¯æ•´ä¸ªç³»ç»Ÿæˆ–è€…æŸä¸ªåŠŸèƒ½æ¨¡å—ã€‚

- å†™å•å…ƒæµ‹è¯•æœ¬èº«ä¸éœ€è¦ä»€ä¹ˆé«˜æ·±æŠ€æœ¯ã€‚å®ƒæ›´å¤šçš„æ˜¯è€ƒéªŒç¨‹åºå‘˜æ€ç»´çš„ç¼œå¯†ç¨‹åº¦ï¼Œçœ‹èƒ½å¦è®¾è®¡å‡ºè¦†ç›–å„ç§æ­£å¸¸åŠå¼‚å¸¸æƒ…å†µçš„æµ‹è¯•ç”¨ä¾‹ã€‚
- å•å…ƒæµ‹è¯•æ˜¯ä¿è¯é‡æ„æ­£ç¡®æ€§çš„å¿…è¦æ‰‹æ®µã€‚å¦‚æœæ–°çš„ä»£ç ä»ç„¶èƒ½é€šè¿‡å•å…ƒæµ‹è¯•ï¼Œé‚£å°±è¯´æ˜ä»£ç åŸæœ‰åŠŸèƒ½çš„æ­£ç¡®æ€§æœªè¢«ç ´åï¼Œå…¶å¤–éƒ¨å¯è§è¡Œä¸ºå¹¶æœªå‘ç”Ÿæ”¹å˜ï¼Œç¬¦åˆé‡æ„çš„å®šä¹‰ã€‚



**å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæµ‹è¯•å¯¹è±¡æ˜¯å‡½æ•°å®šä¹‰çš„åŠŸèƒ½ï¼Œè€Œéå…·ä½“çš„å®ç°é€»è¾‘ã€‚**è¿™æ ·æˆ‘ä»¬æ‰èƒ½åšåˆ°ï¼Œå‡½æ•°çš„å®ç°é€»è¾‘æ”¹å˜äº†ä¹‹åï¼Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ä»ç„¶å¯ä»¥å·¥ä½œã€‚è€Œç¼–å†™è€…è‡ªå·±è´Ÿè´£è¯´æ˜å‡½æ•°çš„åŠŸèƒ½ã€‚**å•å…ƒæµ‹è¯•ç”¨ä¾‹å¦‚ä½•å†™ï¼Œå–å†³äºä½ å¦‚ä½•å®šä¹‰å‡½æ•°çš„åŠŸèƒ½ã€‚**ä»¥ç”ŸæˆIDçš„generateæ–¹æ³•ä¸ºä¾‹ï¼š

- â€œç”Ÿæˆä¸€ä¸ªéšæœºå”¯ä¸€IDâ€ï¼Œé‚£æˆ‘ä»¬åªè¦æµ‹è¯•å¤šæ¬¡è°ƒç”¨generate()å‡½æ•°ç”Ÿæˆçš„IDæ˜¯å¦å”¯ä¸€å³å¯ã€‚
- â€œç”Ÿæˆä¸€ä¸ªåªåŒ…å«æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸­åˆ’çº¿çš„å”¯ä¸€IDâ€ï¼Œé‚£æˆ‘ä»¬ä¸ä»…è¦æµ‹è¯•IDçš„å”¯ä¸€æ€§ï¼Œè¿˜è¦æµ‹è¯•ç”Ÿæˆçš„IDæ˜¯å¦åªåŒ…å«æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸­åˆ’çº¿ã€‚
- â€œç”Ÿæˆå”¯ä¸€IDï¼Œæ ¼å¼ä¸ºï¼š{ä¸»æœºåsubstr}-{æ—¶é—´æˆ³}-{8ä½éšæœºæ•°}ã€‚åœ¨ä¸»æœºåè·å–å¤±è´¥æ—¶ï¼Œè¿”å›ï¼šnull-{æ—¶é—´æˆ³}-{8ä½éšæœºæ•°}â€ï¼Œé‚£æˆ‘ä»¬ä¸ä»…è¦æµ‹è¯•IDçš„å”¯ä¸€æ€§ï¼Œè¿˜è¦æµ‹è¯•ç”Ÿæˆçš„IDæ˜¯å¦å®Œå…¨ç¬¦åˆæ ¼å¼è¦æ±‚ã€‚



å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ˜¯è¡¡é‡å•å…ƒæµ‹è¯•è´¨é‡çš„æ ‡å‡†ä¹‹ä¸€ï¼Œè®¡ç®—æ–¹å¼æœ‰è¯­å¥è¦†ç›–ã€æ¡ä»¶è¦†ç›–ã€åˆ¤å®šè¦†ç›–ã€è·¯å¾„è¦†ç›–ç­‰ã€‚è¦†ç›–ç‡é«˜å¹¶ä¸æ„å‘³ä¹‹æµ‹è¯•è´¨é‡é«˜ï¼Œä¾‹å¦‚ï¼š

~~~java
public double cal(double a, double b) {
  if (b != 0) {
    return a / b;
  }
}
~~~

`call(10.0, 2.0)`è¿™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å°±å¯ä»¥åšåˆ°100%è¦†ç›–ç‡ï¼Œä½†æ˜¯å´å¿½ç•¥äº†è¾¹ç•Œæƒ…å†µ`b = 0.0`ã€‚è€Œä¸”ï¼Œæ²¡å¿…è¦ä¸ºç®€å•çš„æ–¹æ³•ç¼–å†™æµ‹è¯•ä»£ç ï¼ˆä¾‹å¦‚ï¼Œgetã€setï¼‰ã€‚ç›²ç›®çš„è¿½æ±‚è¦†ç›–ç‡ï¼Œåè€Œæ˜¯åœ¨åšæ— ç”¨åŠŸè€Œæ‹–æ…¢é¡¹ç›®çš„è¿›å±•ã€‚é‚£ä¹ˆå•å…ƒæµ‹è¯•åº”è¯¥å†™åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿæˆ‘ä»¬è¦å›åˆ°å†™å•å…ƒæµ‹è¯•çš„åˆè¡·â€”â€”æé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘bugã€‚**å¦‚æœä»£ç è¶³å¤Ÿç®€å•ï¼Œç®€å•åˆ°bugæ— å¤„éšè—ï¼Œé‚£æˆ‘ä»¬å°±æ²¡å¿…è¦ä¸ºäº†å†™å•å…ƒæµ‹è¯•è€Œå†™å•å…ƒæµ‹è¯•äº†ï¼**



ä¸‹é¢é€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥è®²è§£å¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ŒTransactionæ˜¯ä¸€ä¸ªç®€åŒ–çš„ç”µå•†ç³»ç»Ÿçš„äº¤æ˜“ç±»ï¼Œç”¨æ¥è®°å½•æ¯ç¬”è®¢å•äº¤æ˜“çš„æƒ…å†µã€‚

~~~java
public class Transaction {
  private String id;
  private Long buyerId;
  private Long sellerId;
  private Long productId;
  private String orderId;
  private Long createTimestamp;
  private Double amount;
  private STATUS status;
  private String walletTransactionId;
  
  // ...get() methods...
  
  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {
    if (preAssignedId != null && !preAssignedId.isEmpty()) {
      this.id = preAssignedId;
    } else {
      this.id = IdGenerator.generateTransactionId();
    }
    if (!this.id.startWith("t_")) {
      this.id = "t_" + preAssignedId;
    }
    this.buyerId = buyerId;
    this.sellerId = sellerId;
    this.productId = productId;
    this.orderId = orderId;
    this.status = STATUS.TO_BE_EXECUTD;
    this.createTimestamp = System.currentTimestamp();
  }
  
  //è´Ÿè´£æ‰§è¡Œè½¬è´¦æ“ä½œï¼Œå°†é’±ä»ä¹°å®¶çš„é’±åŒ…è½¬åˆ°å–å®¶çš„é’±åŒ…ä¸­ã€‚
  public boolean execute() throws InvalidTransactionException {
    if ((buyerId == null || (sellerId == null || amount < 0.0) {
      throw new InvalidTransactionException(...);
    }
    if (status == STATUS.EXECUTED) return true;
    boolean isLocked = false;
    try {
      //ä¸€ä¸ªåˆ†å¸ƒå¼é”DistributedLockå•ä¾‹ç±»ï¼Œç”¨æ¥é¿å…Transactionå¹¶å‘æ‰§è¡Œï¼Œå¯¼è‡´ç”¨æˆ·çš„é’±è¢«é‡å¤è½¬å‡ºã€‚
      isLocked = RedisDistributedLock.getSingletonIntance().lockTransction(id);
      if (!isLocked) {
        return false; // é”å®šæœªæˆåŠŸï¼Œç›´æ¥è¿”å›false
      }
      if (status == STATUS.EXECUTED) return true; // double check
      long executionInvokedTimestamp = System.currentTimestamp();
      if (executionInvokedTimestamp - createTimestap > 14days) {
        this.status = STATUS.EXPIRED;
        return false;
      }
      
      // çœŸæ­£çš„è½¬è´¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨WalletRpcService RPCæœåŠ¡æ¥å®Œæˆçš„
      WalletRpcService walletRpcService = new WalletRpcService();
      String walletTransactionId = walletRpcService.moveMoney(id, buyerId, sellerId, amount);
      if (walletTransactionId != null) {
        this.walletTransactionId = walletTransactionId;
        this.status = STATUS.EXECUTED;
        return true;
      } else {
        this.status = STATUS.FAILED;
        return false;
      }
    } finally {
      if (isLocked) {
       RedisDistributedLock.getSingletonIntance().unlockTransction(id);
      }
    }
  }
}
~~~

æˆ‘ä»¬ä¸ºexecuteæ–¹æ³•è®¾è®¡å¦‚ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š

- æ­£å¸¸æƒ…å†µä¸‹ï¼Œäº¤æ˜“æ‰§è¡ŒæˆåŠŸï¼Œå›å¡«ç”¨äºå¯¹è´¦ï¼ˆäº¤æ˜“ä¸é’±åŒ…çš„äº¤æ˜“æµæ°´ï¼‰ç”¨çš„walletTransactionIdï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºEXECUTEDï¼Œå‡½æ•°è¿”å›trueã€‚
- buyerIdã€sellerIdä¸ºnullã€amountå°äº0ï¼Œè¿”å›InvalidTransactionExceptionã€‚
- äº¤æ˜“å·²è¿‡æœŸï¼ˆcreateTimestampè¶…è¿‡14å¤©ï¼‰ï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºEXPIREDï¼Œè¿”å›falseã€‚
- ...

æµ‹è¯•ç”¨ä¾‹1çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š

~~~java
public void testExecute() {
  Long buyerId = 123L;
  Long sellerId = 234L;
  Long productId = 345L;
  Long orderId = 456L;
  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);
  boolean executedResult = transaction.execute();
  assertTrue(executedResult);
}
~~~

execute()å‡½æ•°çš„æ‰§è¡Œä¾èµ–ä¸¤ä¸ªå¤–éƒ¨çš„æœåŠ¡ï¼Œä¸€ä¸ªæ˜¯RedisDistributedLockï¼Œä¸€ä¸ªWalletRpcServiceã€‚è¿™å°±å¯¼è‡´ä¸Šé¢çš„å•å…ƒæµ‹è¯•ä»£ç å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š

*   æˆ‘ä»¬éœ€è¦æ­å»ºRedisæœåŠ¡å’ŒWallet RPCæœåŠ¡ï¼Œæ‰èƒ½è®©è¿™ä¸ªå•å…ƒæµ‹è¯•èƒ½å¤Ÿè¿è¡Œã€‚
*   éœ€è¦ä¿è¯å°†transactionæ•°æ®å‘é€ç»™Wallet RPCæœåŠ¡ä¹‹åï¼Œèƒ½å¤Ÿè¿”å›æˆ‘ä»¬æœŸæœ›çš„ç»“æœã€‚ç„¶è€ŒWallet RPCæœåŠ¡æœ‰å¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å¯æ§çš„
*   RPCæœåŠ¡éœ€è¦ç½‘ç»œé€šä¿¡ï¼Œè€—æ—¶å¯èƒ½ä¼šæ¯”è¾ƒé•¿ï¼Œä¼šå½±å“å•å…ƒæµ‹è¯•çš„æ‰§è¡Œæ€§èƒ½ã€‚

å•å…ƒæµ‹è¯•ä¸»è¦æ˜¯æµ‹è¯•ç¨‹åºå‘˜è‡ªå·±ç¼–å†™çš„ä»£ç é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œå¹¶éæ˜¯ç«¯åˆ°ç«¯çš„é›†æˆæµ‹è¯•ï¼Œå®ƒä¸éœ€è¦æµ‹è¯•æ‰€ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆåˆ†å¸ƒå¼é”ã€Wallet RPCæœåŠ¡ï¼‰çš„é€»è¾‘æ­£ç¡®æ€§ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»£ç ä¸­ä¾èµ–äº†å¤–éƒ¨ç³»ç»Ÿæˆ–è€…ä¸å¯æ§ç»„ä»¶ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦è§£é™¤è¢«æµ‹ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–ã€‚è¿™ç§æ–¹æ³•å°±å«ä½œ**â€œmockâ€**ï¼Œå³ç”¨ä¸€ä¸ªâ€œå‡â€çš„æœåŠ¡æ›¿æ¢çœŸæ­£çš„æœåŠ¡ï¼Œæ¨¡æ‹Ÿè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚

å¯ä»¥æ‰‹åŠ¨mockï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨æ¡†æ¶mockã€‚è¿™é‡Œåªå±•ç¤ºæ‰‹åŠ¨mockï¼š

~~~java
public class MockWalletRpcServiceOne extends WalletRpcService {
  public String moveMoney(Long id, Long fromUserId, Long toUserId, Double amount) {
    return "123bac";
  } 
}

public class MockWalletRpcServiceTwo extends WalletRpcService {
  public String moveMoney(Long id, Long fromUserId, Long toUserId, Double amount) {
    return null;
  } 
}
~~~

å› ä¸º`WalletRpcService`å¯¹è±¡æ˜¯åœ¨execute()æ–¹æ³•ä¸­åˆ›å»ºçš„ï¼Œå¯æµ‹è¯•æ€§å¾ˆå·®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡æ„ä»£ç ï¼šä¾èµ–æ³¨å…¥æ˜¯å®ç°ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æˆ‘ä»¬å¯ä»¥åº”ç”¨ä¾èµ–æ³¨å…¥ï¼Œå°†WalletRpcServiceå¯¹è±¡çš„åˆ›å»ºåè½¬ç»™ä¸Šå±‚é€»è¾‘ï¼Œåœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œå†æ³¨å…¥åˆ°Transactionç±»ä¸­ã€‚

~~~java
public class Transaction {
  //...
  // æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡åŠå…¶setæ–¹æ³•
  private WalletRpcService walletRpcService;
  
  public void setWalletRpcService(WalletRpcService walletRpcService) {
    this.walletRpcService = walletRpcService;
  }
    
  // ...
  public boolean execute() {
    // ...
    // åˆ é™¤ä¸‹é¢è¿™ä¸€è¡Œä»£ç 
    // WalletRpcService walletRpcService = new WalletRpcService();
    // ...
  }
}
~~~

é‡æ„ä¹‹åçš„ä»£ç å¯¹åº”çš„å•å…ƒæµ‹è¯•å¦‚ä¸‹æ‰€ç¤ºï¼š

~~~java
public void testExecute() {
  Long buyerId = 123L;
  Long sellerId = 234L;
  Long productId = 345L;
  Long orderId = 456L;
  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);
  // ä½¿ç”¨mockå¯¹è±¡æ¥æ›¿ä»£çœŸæ­£çš„RPCæœåŠ¡
  transaction.setWalletRpcService(new MockWalletRpcServiceOne()):
  boolean executedResult = transaction.execute();
  assertTrue(executedResult);
  assertEquals(STATUS.EXECUTED, transaction.getStatus());
}
~~~

æˆ‘ä»¬å†æ¥çœ‹RedisDistributedLockçš„mockã€‚å®ƒçš„æ›¿æ¢æ¯”è¾ƒå¤æ‚ï¼Œä¸»è¦åŸå› æ˜¯RedisDistributedLockæ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œåªèƒ½è°ƒç”¨é™æ€æ–¹æ³•getSingletonIntance()æ¥åˆ›å»ºå¯¹è±¡ã€‚æˆ‘ä»¬æ— æ³•ç»§æ‰¿å’Œé‡å†™æ–¹æ³•ï¼Œä¹Ÿæ— æ³•é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥æ›¿æ¢ã€‚

å¦‚æœRedisDistributedLockæ˜¯æˆ‘ä»¬è‡ªå·±ç»´æŠ¤çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£`IDistributedLock`ï¼Œè®©RedisDistributedLockå®ç°è¿™ä¸ªæ¥å£å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥åƒå‰é¢WalletRpcServiceçš„æ›¿æ¢æ–¹å¼é‚£æ ·ï¼Œæ›¿æ¢RedisDistributedLockä¸ºMockRedisDistributedLockäº†ã€‚å¦‚æœRedisDistributedLockæ˜¯ç¬¬ä¸‰æ–¹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹transactionä¸Šé”è¿™éƒ¨åˆ†é€»è¾‘é‡æ–°å°è£…ä¸€ä¸‹ï¼š

~~~java
public class TransactionLock {
  public boolean lock(String id) {
    return RedisDistributedLock.getSingletonIntance().lockTransction(id);
  }
  
  public void unlock() {
    RedisDistributedLock.getSingletonIntance().unlockTransction(id);
  }
}

public class Transaction {
  //...
  private TransactionLock lock;
  
  public void setTransactionLock(TransactionLock lock) {
    this.lock = lock;
  }
 
  public boolean execute() {
    //...
    try {
      isLocked = lock.lock();
      //...
    } finally {
      if (isLocked) {
        lock.unlock();
      }
    }
    //...
  }
}

~~~

å•å…ƒæµ‹è¯•ä»£ç ï¼š

~~~java
public void testExecute() {
  Long buyerId = 123L;
  Long sellerId = 234L;
  Long productId = 345L;
  Long orderId = 456L;
  
  //è¦†å†™é€»è¾‘
  TransactionLock mockLock = new TransactionLock() {
    public boolean lock(String id) {
      return true;
    }
  
    public void unlock() {}
  };
  
  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);
  transaction.setWalletRpcService(new MockWalletRpcServiceOne());
   
  //ä¼ å…¥mock
  transaction.setTransactionLock(mockLock);
  boolean executedResult = transaction.execute();
  assertTrue(executedResult);
  assertEquals(STATUS.EXECUTED, transaction.getStatus());
}
~~~



ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹æµ‹è¯•ç”¨ä¾‹3â€”â€”åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒTransactionç±»å¹¶æ²¡æœ‰æš´éœ²ä¿®æ”¹createdTimestampæˆå‘˜å˜é‡çš„setæ–¹æ³•ã€‚æœ€ç®€å•çš„åŠæ³•å°±æ˜¯é‡æ–°æ·»åŠ ä¸€ä¸ªsetterï¼Œä½†æ˜¯è¿™è¿åäº†ç±»çš„å°è£…ç‰¹æ€§ã€‚æ­£ç¡®çš„å¤„ç†æ–¹å¼æ˜¯å°†è¿™ç§æœªå†³è¡Œä¸ºé€»è¾‘é‡æ–°å°è£…ï¼Œç„¶åå†é‡è½½ã€‚

~~~java
public class Transaction {

  protected boolean isExpired() {
    long executionInvokedTimestamp = System.currentTimestamp();
    return executionInvokedTimestamp - createdTimestamp > 14days;
  }
  
  public boolean execute() throws InvalidTransactionException {
    //...
      if (isExpired()) {
        this.status = STATUS.EXPIRED;
        return false;
      }
    //...
  }
}
~~~

é’ˆå¯¹é‡æ„ä¹‹åçš„ä»£ç ï¼Œæµ‹è¯•ç”¨ä¾‹3çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

~~~java
public void testExecute_with_TransactionIsExpired() {
  Long buyerId = 123L;
  Long sellerId = 234L;
  Long productId = 345L;
  Long orderId = 456L;
  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId) {
    protected boolean isExpired() {
      return true;
    }
  };
  boolean actualResult = transaction.execute();
  assertFalse(actualResult);
  assertEquals(STATUS.EXPIRED, transaction.getStatus());
}
~~~

é€šè¿‡é‡æ„ï¼ŒTransactionä»£ç çš„å¯æµ‹è¯•æ€§æé«˜äº†.

æˆ‘ä»¬ç»§ç»­å¯¹æ„é€ å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºå®ƒå…¶ä¸­åŒ…å«äº†é€»è¾‘æ¯”è¾ƒå¤æ‚çš„idèµ‹å€¼

~~~java
  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {
    if (preAssignedId != null && !preAssignedId.isEmpty()) {
      this.id = preAssignedId;
    } else {
      this.id = IdGenerator.generateTransactionId();
    }
    if (!this.id.startWith("t_")) {
      this.id = "t_" + preAssignedId;
    }
    this.buyerId = buyerId;
    this.sellerId = sellerId;
    this.productId = productId;
    this.orderId = orderId;
    this.status = STATUS.TO_BE_EXECUTD;
    this.createTimestamp = System.currentTimestamp();
  }
~~~

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠidèµ‹å€¼è¿™éƒ¨åˆ†é€»è¾‘å•ç‹¬æŠ½è±¡åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

~~~java
  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {
    //...
    fillTransactionId(preAssignId);
    //...
  }
  
  protected void fillTransactionId(String preAssignedId) {
    if (preAssignedId != null && !preAssignedId.isEmpty()) {
      this.id = preAssignedId;
    } else {
      this.id = IdGenerator.generateTransactionId();
    }
    if (!this.id.startWith("t_")) {
      this.id = "t_" + preAssignedId;
    }
  }
~~~

è¿™æ ·é€šè¿‡é‡è½½å—ä¿æŠ¤å‡½æ•°`fillTransactionId`æ¥å®Œæˆmockä»£æ›¿ã€‚

æ— è®ºæ˜¯ä¾èµ–æ³¨å…¥ï¼Œè¿˜æ˜¯é‡è½½å‡½æ•°ï¼Œå®ƒä»¬åˆ†åˆ«æŠŠç±»ä¸­çš„ç§æœ‰çŠ¶æ€ä»¥åŠç§æœ‰æ‰§è¡Œé€»è¾‘æš´éœ²äº†å‡ºå»ï¼Œç ´åäº†å°è£…æ€§ã€‚ä½†è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸º

- æš´éœ²å‡ºå»çš„çŠ¶æ€ï¼Œåªèƒ½æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè€Œä¸èƒ½åƒsetteræ–¹æ³•é‚£æ ·éšæ„ä¿®æ”¹ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿ç•™äº†å°è£…æ€§
- ç§æœ‰æ‰§è¡Œé€»è¾‘çš„æš´éœ²æ˜¯æ— å…³ç´§è¦çš„ã€‚å› ä¸ºå½“è°ƒç”¨è€…å¼€å§‹è¦†å†™æ—¶ï¼Œç¡®ä¿è¦†å†™è¡Œä¸ºæ­£ç¡®æ€§çš„è´£ä»»å°±è½¬ç§»åˆ°è°ƒç”¨è€…äº†ï¼Œç±»åº“ä½œè€…æ— éœ€ä¸ºé‡è½½åçš„é”™è¯¯è€Œè´Ÿè´£ã€‚
- æé«˜äº†ä»£ç å¯æµ‹è¯•æ€§



## ç¼–ç¨‹è§„èŒƒ

å¯¹äºä¸åŒçš„ç¼–ç¨‹è§„èŒƒæ¥è¯´ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ã€‚åœ¨éµå¾ªå›¢é˜Ÿçš„ç¼–ç¨‹è§„èŒƒå‰æä¸‹ï¼Œæ€ä¹ˆèˆ’æœæ€ä¹ˆç”¨ã€‚

### å‘½åä¸æ³¨é‡Šï¼ˆNaming and Commentsï¼‰

å‘½åçš„å¥½åï¼Œå¯¹äºä»£ç çš„å¯è¯»æ€§æ¥è¯´éå¸¸é‡è¦ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å‘½åå‘¢ï¼Ÿå‡†ç¡®è¾¾æ„ï¼

- åœ¨è¶³å¤Ÿè¡¨è¾¾å…¶å«ä¹‰çš„æƒ…å†µä¸‹ï¼Œå‘½åå½“ç„¶æ˜¯è¶ŠçŸ­è¶Šå¥½ã€‚é•¿çš„å‘½åè™½ç„¶æ›´èƒ½å‡†ç¡®ç›´è§‚åœ°è¡¨è¾¾æ„å›¾ï¼Œä½†æ˜¯ç”±äºä»£ç åˆ—é•¿åº¦æœ‰é™åˆ¶ï¼Œç»å¸¸å‡ºç°ä¸€æ¡è¯­å¥åˆ†æˆå¤šè¡Œçš„æƒ…å†µã€‚çŸ­çš„å‘½ååˆä¼šè¡¨æ„ä¸æ¸…ã€‚

- åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–å‘½åï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚

  ~~~java
  public class User {
    private String userName;
    private String userPassword;
    private String userAvatarUrl;
    //...
  }
  ~~~

  åœ¨Userç±»è¿™æ ·ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬æ²¡å¿…è¦æ·»åŠ userè¿™ä¸ªå‰ç¼€ã€‚é™¤äº†ç±»ä¹‹å¤–ï¼Œå‡½æ•°å‚æ•°ä¹Ÿå¯ä»¥å€ŸåŠ©å‡½æ•°è¿™ä¸ªä¸Šä¸‹æ–‡æ¥ç®€åŒ–å‘½åã€‚

  ~~~java
  public void uploadUserAvatarImageToAliyun(String userAvatarImageUri);
  //åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–ä¸ºï¼š
  public void uploadUserAvatarImageToAliyun(String imageUri);
  ~~~

- å‘½åå¯æœç´¢ï¼šæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨â€œå…³é”®è¯è”æƒ³â€çš„æ–¹æ³•æ¥è‡ªåŠ¨è¡¥å…¨å’Œæœç´¢ã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦è·å–æŸä¸ªå¯¹è±¡æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šè”æƒ³åˆ°â€œgetXXXXâ€ã€‚

- å¯¹äºæ¥å£çš„å‘½åï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚å¯¹äºå®ç°ç±»`UserService`æ¥è¯´ï¼Œå…¶æ¥å£çš„å‘½åä¸º

  	- å‰ç¼€â€œIâ€ï¼šIUserService
  	- åç¼€â€œImplâ€ï¼šUserServiceImpl

  å¯¹äºæŠ½è±¡ç±»çš„å‘½åï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å¸¦ä¸Šå‰ç¼€â€œAbstractâ€ï¼Œæ¯”å¦‚`AbstractConfiguration`ï¼›å¦ä¸€ç§æ˜¯ä»€ä¹ˆä¹Ÿä¸åŠ ã€‚



æ³¨é‡Šçš„ç›®çš„å°±æ˜¯è®©ä»£ç æ›´å®¹æ˜“çœ‹æ‡‚ã€‚ä¸»è¦åŒ…å«è¿™æ ·ä¸‰ä¸ªæ–¹é¢ï¼šåšä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšã€‚è¿˜å¯ä»¥è¯´æ˜å‰ç½®æ¡ä»¶ã€åç½®æ¡ä»¶ã€å‚æ•°çš„å«ä¹‰ã€è¿”å›å€¼çš„å«ä¹‰ã€å¼‚å¸¸ç­‰ç­‰

ä¾‹å¦‚ï¼š

~~~java
/**
* (what) Bean factory to create beans. 
* 
* (why) The class likes Spring IOC framework, but is more lightweight. 
*
* (how) Create objects from different sources sequentially:
* user specified object > SPI > configuration > default object.
*/
public class BeansFactory {
  // ...
}
~~~

æœ‰äº›äººè®¤ä¸ºï¼Œæ³¨é‡Šæ˜¯è¦æä¾›ä¸€äº›ä»£ç æ²¡æœ‰çš„é¢å¤–ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸è¦å†™â€œåšä»€ä¹ˆã€æ€ä¹ˆåšâ€ã€‚åªéœ€è¦å†™æ¸…æ¥šâ€œä¸ºä»€ä¹ˆâ€ï¼Œè¡¨æ˜ä»£ç çš„è®¾è®¡æ„å›¾å³å¯ã€‚ä¸ªäººè®¤ä¸ºæœ‰äº›é“ç†ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¼ºçƒˆæ¨èè¿˜æ˜¯è¦å†™åšä»€ä¹ˆã€æ€ä¹ˆåšçš„æ€»ç»“æ¦‚æ‹¬æ€§è¯è¯­ï¼Œæ–¹ä¾¿åˆ«äººé˜…è¯»æºç ã€‚

### ä»£ç é£æ ¼ï¼ˆCode Styleï¼‰

åŸºæœ¬ä¸Šå°±æ˜¯å¤§æ‹¬å·æ˜¯å¦æ¢è¡Œã€ç¼©è¿›å‡ è¡Œè¿™æ ·çš„çç¢é—®é¢˜ã€‚æ•…è¿™éƒ¨åˆ†å†…å®¹ä¸å†ä»‹ç»ã€‚

### ç¼–ç¨‹æŠ€å·§ï¼ˆCoding Tipsï¼‰

å¤§éƒ¨åˆ†äººé˜…è¯»ä»£ç çš„ä¹ æƒ¯éƒ½æ˜¯ï¼Œå…ˆçœ‹æ•´ä½“å†çœ‹ç»†èŠ‚ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å–„äºå°†**å¤§å—çš„å¤æ‚é€»è¾‘**æç‚¼æˆç±»æˆ–è€…å‡½æ•°ï¼Œå±è”½æ‰ç»†èŠ‚ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚

~~~java
// é‡æ„å‰çš„ä»£ç 
public void invest(long userId, long financialProductId) {
  Calendar calendar = Calendar.getInstance();
  calendar.setTime(date);
  calendar.set(Calendar.DATE, (calendar.get(Calendar.DATE) + 1));
  if (calendar.get(Calendar.DAY_OF_MONTH) == 1) {
    return;
  }
  //...
}

// é‡æ„åçš„ä»£ç ï¼š
public void invest(long userId, long financialProductId) {
  if (isLastDayOfMonth(new Date())) {
    return;
  }
  //...
}

//æç‚¼å‡ºå‡½æ•°isLastDayOfMonthï¼Œé€»è¾‘æ›´æ¸…æ™°ã€‚
public boolean isLastDayOfMonth(Date date) {
  Calendar calendar = Calendar.getInstance();
  calendar.setTime(date);
  calendar.set(Calendar.DATE, (calendar.get(Calendar.DATE) + 1));
  if (calendar.get(Calendar.DAY_OF_MONTH) == 1) {
   return true;
  }
  return false;
}
~~~



é’ˆå¯¹å‡½æ•°å‚æ•°è¿‡å¤šï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

- è€ƒè™‘å‡½æ•°æ˜¯å¦èŒè´£å•ä¸€ï¼Œæ˜¯å¦èƒ½é€šè¿‡æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°çš„æ–¹å¼æ¥å‡å°‘å‚æ•°

  ~~~java
  public User getUser(String username, String telephone, String email);
  
  // æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°
  public User getUserByUsername(String username);
  public User getUserByTelephone(String telephone);
  public User getUserByEmail(String email);
  ~~~

- å°†å‡½æ•°çš„å‚æ•°å°è£…æˆå¯¹è±¡

  ~~~java
  public void postBlog(String title, String summary, String keywords, String content, String category, long authorId);
  
  // å°†å‚æ•°å°è£…æˆå¯¹è±¡
  public class Blog {
    private String title;
    private String summary;
    private String keywords;
    private Strint content;
    private String category;
    private long authorId;
  }
  public void postBlog(Blog blog);
  ~~~

  

ä¸è¦ä½¿ç”¨å¸ƒå°”å‹å‚æ•°æ¥æ§åˆ¶å‡½æ•°çš„å†…éƒ¨é€»è¾‘ï¼Œè¿™æ˜æ˜¾è¿èƒŒäº†å•ä¸€èŒè´£åŸåˆ™ã€‚å»ºè®®å°†å…¶æ‹†æˆä¸¤ä¸ªå‡½æ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼š

~~~java
public void buyCourse(long userId, long courseId, boolean isVip);

boolean isVip = false;
//...çœç•¥å…¶ä»–é€»è¾‘...
buyCourse(userId, courseId, isVip);



// å°†å…¶æ‹†åˆ†æˆä¸¤ä¸ªå‡½æ•°
public void buyCourse(long userId, long courseId);
public void buyCourseForVip(long userId, long courseId);

// æ‹†åˆ†æˆä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨æ–¹å¼
boolean isVip = false;
//...çœç•¥å…¶ä»–é€»è¾‘...
if (isVip) {
  buyCourseForVip(userId, courseId);
} else {
  buyCourse(userId, courseId);
}
~~~

é™¤äº†è¿™ç§æƒ…å†µï¼Œè¿˜æœ‰â€œæ ¹æ®å‚æ•°æ˜¯å¦ä¸ºnullâ€æ¥æ§åˆ¶é€»è¾‘çš„æƒ…å†µã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥å°†å…¶æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°ã€‚æ‹†åˆ†ä¹‹åçš„å‡½æ•°èŒè´£æ›´æ˜ç¡®ï¼Œä¸å®¹æ˜“ç”¨é”™ã€‚

~~~java
public List<Transaction> selectTransactions(Long userId, Date startDate, Date endDate) {
  if (startDate != null && endDate != null) {
    // æŸ¥è¯¢ä¸¤ä¸ªæ—¶é—´åŒºé—´çš„transactions
  }
  if (startDate != null && endDate == null) {
    // æŸ¥è¯¢startDateä¹‹åçš„æ‰€æœ‰transactions
  }
  if (startDate == null && endDate != null) {
    // æŸ¥è¯¢endDateä¹‹å‰çš„æ‰€æœ‰transactions
  }
  if (startDate == null && endDate == null) {
    // æŸ¥è¯¢æ‰€æœ‰çš„transactions
  }
}


// æ‹†åˆ†æˆå¤šä¸ªpublicå‡½æ•°ï¼Œæ›´åŠ æ¸…æ™°ã€æ˜“ç”¨
public List<Transaction> selectTransactionsBetween(Long userId, Date startDate, Date endDate) {
  return selectTransactions(userId, startDate, endDate);
}

public List<Transaction> selectTransactionsStartWith(Long userId, Date startDate) {
  return selectTransactions(userId, startDate, null);
}

public List<Transaction> selectTransactionsEndWith(Long userId, Date endDate) {
  return selectTransactions(userId, null, endDate);
}

public List<Transaction> selectAllTransactions(Long userId) {
  return selectTransactions(userId, null, null);
}

//æ³¨æ„è¿™é‡ŒselectTransactionsæ˜¯ç§æœ‰çš„ï¼Œå…¶ä»–å››ä¸ªå‡½æ•°éƒ½æ˜¯selectTransactionçš„å°è£…
private List<Transaction> selectTransactions(Long userId, Date startDate, Date endDate) {
  // ...
}
~~~



ä¸ªäººå»ºè®®ï¼ŒåµŒå¥—æœ€å¥½ä¸è¶…è¿‡ä¸¤å±‚ï¼ˆFlutter è¯´ä½ å‘¢ğŸ™„ï¼‰ã€‚ä¸‹é¢æ˜¯è§£å†³åµŒå¥—è¿‡æ·±çš„æ€è·¯ï¼š

- å»æ‰å¤šä½™çš„ifæˆ–elseè¯­å¥

  ~~~java
  // ç¤ºä¾‹ä¸€
  public double caculateTotalAmount(List<Order> orders) {
    if (orders == null || orders.isEmpty()) {
      return 0.0;
    } else { // æ­¤å¤„çš„elseå¯ä»¥å»æ‰
      double amount = 0.0;
      for (Order order : orders) {
        if (order != null) {
          amount += (order.getCount() * order.getPrice());
        }
      }
      return amount;
    }
  }
  
  // ç¤ºä¾‹äºŒ
  public List<String> matchStrings(List<String> strList,String substr) {
    List<String> matchedStrings = new ArrayList<>();
    if (strList != null && substr != null) {
      for (String str : strList) {
        if (str != null) { // è·Ÿä¸‹é¢çš„ifè¯­å¥å¯ä»¥åˆå¹¶åœ¨ä¸€èµ·
          if (str.contains(substr)) {
            matchedStrings.add(str);
          }
        }
      }
    }
    return matchedStrings;
  }
  ~~~

- ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„continueã€breakã€returnå…³é”®å­—ï¼Œæå‰é€€å‡ºåµŒå¥—

  ~~~java
  // é‡æ„å‰çš„ä»£ç 
  public List<String> matchStrings(List<String> strList,String substr) {
    List<String> matchedStrings = new ArrayList<>();
    if (strList != null && substr != null){ 
      for (String str : strList) {
        if (str != null && str.contains(substr)) {
          matchedStrings.add(str);
          // æ­¤å¤„è¿˜æœ‰10è¡Œä»£ç ...
        }
      }
    }
    return matchedStrings;
  }
  
  // é‡æ„åçš„ä»£ç ï¼šä½¿ç”¨continueæå‰é€€å‡º
  public List<String> matchStrings(List<String> strList,String substr) {
    List<String> matchedStrings = new ArrayList<>();
    if (strList != null && substr != null){ 
      for (String str : strList) {
        //é€»è¾‘å–å
        if (str == null || !str.contains(substr)) {
          continue; 
        }
        matchedStrings.add(str);
        // æ­¤å¤„è¿˜æœ‰10è¡Œä»£ç ...
      }
    }
    return matchedStrings;
  }
  ~~~

- è°ƒæ•´æ‰§è¡Œé¡ºåºæ¥å‡å°‘åµŒå¥—ã€‚

  ~~~java
  // é‡æ„å‰çš„ä»£ç 
  public List<String> matchStrings(List<String> strList,String substr) {
    List<String> matchedStrings = new ArrayList<>();
    if (strList != null && substr != null) {
      for (String str : strList) {
        if (str != null) {
          if (str.contains(substr)) {
            matchedStrings.add(str);
          }
        }
      }
    }
    return matchedStrings;
  }
  
  // é‡æ„åçš„ä»£ç ï¼šå…ˆæ‰§è¡Œåˆ¤ç©ºé€»è¾‘ï¼Œå†æ‰§è¡Œæ­£å¸¸é€»è¾‘
  public List<String> matchStrings(List<String> strList,String substr) {
    if (strList == null || substr == null) { //é€»è¾‘å–å
      return Collections.emptyList();
    }
  
    List<String> matchedStrings = new ArrayList<>();
    for (String str : strList) {
      if (str != null) {
        if (str.contains(substr)) {
          matchedStrings.add(str);
        }
      }
    }
    return matchedStrings;
  }
  ~~~

- å°†éƒ¨åˆ†åµŒå¥—é€»è¾‘å°è£…æˆå‡½æ•°è°ƒç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åµŒå¥—

  ~~~java
  // é‡æ„å‰çš„ä»£ç 
  public List<String> appendSalts(List<String> passwords) {
    if (passwords == null || passwords.isEmpty()) {
      return Collections.emptyList();
    }
    
    List<String> passwordsWithSalt = new ArrayList<>();
    for (String password : passwords) {
      if (password == null) {
        continue;
      }
      if (password.length() < 8) {
        // ...
      } else {
        // ...
      }
    }
    return passwordsWithSalt;
  }
  
  // é‡æ„åçš„ä»£ç ï¼šå°†éƒ¨åˆ†é€»è¾‘æŠ½æˆå‡½æ•°
  public List<String> appendSalts(List<String> passwords) {
    if (passwords == null || passwords.isEmpty()) {
      return Collections.emptyList();
    }
  
    List<String> passwordsWithSalt = new ArrayList<>();
    for (String password : passwords) {
      if (password == null) {
        continue;
      }
      passwordsWithSalt.add(appendSalt(password));
    }
    return passwordsWithSalt;
  }
  
  private String appendSalt(String password) {
    String passwordWithSalt = password;
    if (password.length() < 8) {
      // ...
    } else {
      // ...
    }
    return passwordWithSalt;
  }
  ~~~





æœ€åæˆ‘ä»¬è¦å­¦ä¼šä½¿ç”¨è§£é‡Šæ€§å˜é‡ï¼š

- å–ä»£é­”æ³•æ•°å­—

  ~~~java
  public double CalculateCircularArea(double radius) {
    return (3.1415) * radius * radius;
  }
  
  // æ›¿ä»£é­”æ³•æ•°å­—
  public static final Double PI = 3.1415;
  public double CalculateCircularArea(double radius) {
    return PI * radius * radius;
  }
  ~~~

- è§£é‡Šå¤æ‚è¡¨è¾¾å¼

  ~~~java
  if (date.after(SUMMER_START) && date.before(SUMMER_END)) {
    // ...
  } else {
    // ...
  }
  
  // å¼•å…¥è§£é‡Šæ€§å˜é‡åé€»è¾‘æ›´åŠ æ¸…æ™°
  boolean isSummer = date.after(SUMMER_START)&&date.before(SUMMER_END);
  if (isSummer) {
    // ...
  } else {
    // ...
  } 
  ~~~

  

