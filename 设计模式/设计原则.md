# è®¾è®¡åŸåˆ™

åˆ‡è®°ä¸è¦æ•™æ¡ä¸»ä¹‰ï¼Œç”Ÿæ¬ç¡¬å¥—ï¼Œé€‚å¾—å…¶åã€‚

[TOC]

## å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰

> A class or module should have a single responsibility
>
> ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£ã€‚



å¦‚æœæŸç±»åŒ…å«äº†è‹¥å¹²ä¸ªä¸šåŠ¡ä¸Šä¸ç›¸å…³çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆè€ƒè™‘å°†è¯¥ç±»æ‹†åˆ†æˆç²’åº¦æ›´ç»†ã€åŠŸèƒ½æ›´åŠ å•ä¸€çš„å¤šä¸ªç±»ã€‚

å¯¹äºä¸€ä¸ªç±»æ˜¯å¦ç¬¦åˆSRPï¼Œæ˜¯æ²¡æœ‰ä¸€ä¸ªéå¸¸æ˜ç¡®çš„ã€å¯ä»¥é‡åŒ–çš„æ ‡å‡†ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªç¤¾äº¤äº§å“ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„UserInfoç±»æ¥è®°å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼š

~~~java
public class UserInfo {
  private long userId;
  private String username;
  private String email;
  private String telephone;
  private long createTime;
  private long lastLoginTime;
  private String avatarUrl;
  private String provinceOfAddress; // çœ
  private String cityOfAddress; // å¸‚
  private String regionOfAddress; // åŒº 
  private String detailedAddress; // è¯¦ç»†åœ°å€
  // ...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
}
~~~

UserInfoç±»çš„è®¾è®¡æ˜¯å¦æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™å‘¢ï¼Ÿ

- UserInfoç±»åŒ…å«çš„éƒ½æ˜¯è·Ÿç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½éš¶å±äºç”¨æˆ·è¿™æ ·ä¸€ä¸ªä¸šåŠ¡æ¨¡å‹ï¼Œæ»¡è¶³å•ä¸€èŒè´£åŸåˆ™
- åœ°å€ä¿¡æ¯åœ¨UserInfoç±»ä¸­ï¼Œæ‰€å çš„æ¯”é‡æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ç»§ç»­æ‹†åˆ†æˆç‹¬ç«‹çš„UserAddressç±»ã€‚

å“ªç§è§‚ç‚¹æ›´å¯¹å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¦ä»ä¸­åšå‡ºé€‰æ‹©ï¼Œæˆ‘ä»¬**ä¸èƒ½è„±ç¦»å…·ä½“çš„åº”ç”¨åœºæ™¯**ã€‚å¦‚æœåœ¨è¿™ä¸ªç¤¾äº¤äº§å“ä¸­ï¼Œç”¨æˆ·çš„Addressä¿¡æ¯è·Ÿå…¶ä»–ä¿¡æ¯ä¸€æ ·ï¼Œåªæ˜¯å•çº¯åœ°ç”¨æ¥å±•ç¤ºï¼Œé‚£UserInfoç°åœ¨çš„è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚å¦‚æœåœ°å€åœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨æ‰ï¼Œé‚£æˆ‘ä»¬æœ€å¥½å°†Addressä»UserInfoä¸­æ‹†åˆ†å‡ºæ¥ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå†™ä¸€ä¸ªæ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„ç±»ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¦‚æœç±»è¶Šæ¥è¶Šåºå¤§ï¼Œä»£ç è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸ªç²—ç²’åº¦çš„ç±»ï¼Œæ‹†åˆ†æˆå‡ ä¸ªæ›´ç»†ç²’åº¦çš„ç±»ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æŒç»­é‡æ„ã€‚

ä¸€å‘³åœ°æ‹†åˆ†ç±»ï¼Œåè€Œé™ä½ä»£ç çš„å¯ç»´æŠ¤æ€§ä»¥åŠå†…èšæ€§ã€‚ä¾‹å¦‚ï¼ŒSerializationç±»å®ç°äº†ä¸€ä¸ªç®€å•åè®®çš„åºåˆ—åŒ–å’Œååºåˆ—åŠŸèƒ½ï¼š

~~~java
public class Serialization {
  private static final String IDENTIFIER_STRING = "UEUEUE;";
  
  public Serialization() {}
  public String serialize(Map<String, String> object) {}
  public Map<String, String> deserialize(String text) {}
}

~~~

å¦‚æœæˆ‘ä»¬æƒ³è®©ç±»çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹Serializationç±»è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œæ‹†åˆ†æˆä¸€ä¸ªåªè´Ÿè´£åºåˆ—åŒ–å·¥ä½œçš„Serializerç±»ï¼Œå’Œå¦ä¸€ä¸ªåªè´Ÿè´£ååºåˆ—åŒ–å·¥ä½œçš„Deserializerç±»ï¼š

~~~java
public class Serializer {
  private static final String IDENTIFIER_STRING = "UEUEUE;";

  public Serializer() {}
  public String serialize(Map<String, String> object) {}
}

public class Deserializer {
  private static final String IDENTIFIER_STRING = "UEUEUE;";
  
  public Deserializer() {}
  public Map<String, String> deserialize(String text) {}
}
~~~

å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†åè®®çš„æ ¼å¼ï¼Œæ•°æ®æ ‡è¯†ä»â€œUEUEUEâ€æ”¹ä¸ºâ€œDFDFDFâ€ï¼Œé‚£Serializerç±»å’ŒDeserializerç±»éƒ½éœ€è¦åšç›¸åº”çš„ä¿®æ”¹ï¼Œä»£ç çš„å†…èšæ€§æ˜¾ç„¶æ²¡æœ‰åŸæ¥Serializationé«˜äº†ã€‚å¦‚æœè€Œå¿˜è®°äº†ä¿®æ”¹Deserializerç±»çš„ä»£ç ï¼Œé‚£å°±ä¼šå¯¼è‡´åºåˆ—åŒ–ã€ååºåˆ—åŒ–ä¸åŒ¹é…ï¼Œç¨‹åºè¿è¡Œå‡ºé”™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‹†åˆ†ä¹‹åï¼Œä»£ç çš„å¯ç»´æŠ¤æ€§å˜å·®äº†ã€‚

è¦è®°ä½ï¼Œ**è¿™äº›åŸåˆ™ä¸ºäº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¤ç”¨æ€§ã€å†…èšæ€§ç­‰è€ŒæœåŠ¡**ã€‚å¦‚æœå¥—ç”¨æŸä¸ªåŸåˆ™åï¼Œå‘ç°ä»£ç çš„å¯ç»´æŠ¤æ€§ä¸‹é™äº†ï¼Œé‚£ä¹ˆå°±ä¸è¦å†ä½¿ç”¨è¯¥åŸåˆ™äº†

## å¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼‰

> software entities (modules, classes, functions, etc.) should be open for extension , but closed for modification
>
> è½¯ä»¶å®ä½“ï¼ˆæ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰åº”è¯¥â€œå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­â€ã€‚

å³æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½åº”è¯¥æ˜¯åœ¨å·²æœ‰ä»£ç åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰ã€‚å®ƒè§£å†³çš„æ˜¯ä»£ç çš„æ‰©å±•æ€§é—®é¢˜ã€‚

ä¸‹é¢ç»™å‡ºAPIæ¥å£ç›‘æ§å‘Šè­¦çš„ä¾‹å­ï¼š

~~~java
public class Alert {
  private AlertRule rule;						//AlertRuleå­˜å‚¨å‘Šè­¦è§„åˆ™
  private Notification notification;			//Notificationæ˜¯å‘Šè­¦é€šçŸ¥ç±»ï¼Œæ”¯æŒé‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡ã€æ‰‹æœºç­‰å¤šç§é€šçŸ¥æ¸ é“

  public Alert(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }

  public void check(String api, long requestCount, long errorCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
      
    // NotificationEmergencyLevelè¡¨ç¤ºé€šçŸ¥çš„ç´§æ€¥ç¨‹åº¦ï¼ŒåŒ…æ‹¬SEVEREï¼ˆä¸¥é‡ï¼‰ã€URGENCYï¼ˆç´§æ€¥ï¼‰ã€NORMALï¼ˆæ™®é€šï¼‰ã€TRIVIALï¼ˆæ— å…³ç´§è¦ï¼‰ï¼Œä¸åŒçš„ç´§æ€¥ç¨‹åº¦å¯¹åº”ä¸åŒçš„å‘é€æ¸ é“ã€‚
    if (tps > rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, "...");
    }
    if (errorCount > rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, "...");
    }
  }
}

~~~

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“æ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°ï¼Œè¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§é˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè¦è§¦å‘å‘Šè­¦å‘é€é€šçŸ¥ã€‚

~~~java
//// æ”¹åŠ¨ä¸€ï¼šæ·»åŠ å‚æ•°timeoutCount
public void check(String api, long requestCount, long errorCount, long timeoutCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
    if (tps > rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, "...");
    }
    if (errorCount > rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, "...");
    }
    // æ”¹åŠ¨äºŒï¼šæ·»åŠ æ¥å£è¶…æ—¶å¤„ç†é€»è¾‘
    long timeoutTps = timeoutCount / durationOfSeconds;
    if (timeoutTps > rule.getMatchedRule(api).getMaxTimeoutTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, "...");
    }
  }
~~~

è¿™æ ·çš„ä»£ç ä¿®æ”¹å®é™…ä¸Šå­˜åœ¨æŒºå¤šé—®é¢˜çš„ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯¹æ¥å£è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™å°±æ„å‘³ç€è°ƒç”¨è¿™ä¸ªæ¥å£çš„ä»£ç éƒ½è¦åšç›¸åº”çš„ä¿®æ”¹ã€‚å¦ä¸€æ–¹é¢ï¼Œä¿®æ”¹äº†check()å‡½æ•°ï¼Œç›¸åº”çš„å•å…ƒæµ‹è¯•éƒ½éœ€è¦ä¿®æ”¹ã€‚

å¦‚æœæˆ‘ä»¬éµå¾ªå¼€é—­åŸåˆ™ï¼Œæ¥å®ç°åŒæ ·çš„åŠŸèƒ½å‘¢ï¼Ÿæˆ‘ä»¬å…ˆé‡æ„ä¸€ä¸‹ä¹‹å‰çš„Alertä»£ç ï¼Œé‡æ„çš„å†…å®¹ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š

*   ç¬¬ä¸€éƒ¨åˆ†æ˜¯å°†check()å‡½æ•°çš„å¤šä¸ªå…¥å‚å°è£…æˆApiStatInfoç±»ï¼›
*   ç¬¬äºŒéƒ¨åˆ†æ˜¯å¼•å…¥handlerçš„æ¦‚å¿µï¼Œå°†ifåˆ¤æ–­é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªhandlerä¸­ã€‚

~~~java
public class Alert {
  private List<AlertHandler> alertHandlers = new ArrayList<>();
  
  public void addAlertHandler(AlertHandler alertHandler) {
    this.alertHandlers.add(alertHandler);
  }

  public void check(ApiStatInfo apiStatInfo) {
    for (AlertHandler handler : alertHandlers) {
      handler.check(apiStatInfo);
    }
  }
}

// å°†åŸæœ¬çš„å‚æ•°æŠ½è±¡æˆä¸€ä¸ªç±»ã€‚
// è¿™å°†å‚æ•°è§£è€¦ï¼Œæ¯ä¸ªhandleçš„checkæ–¹æ³•ä½¿ç”¨è‡ªå·±æ‰€éœ€çš„å‚æ•°å³å¯ã€‚

public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
}

//æ¯ä¸€ä¸ªHandleçš„checkæ–¹æ³•çš„é€»è¾‘éƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæŠ½è±¡æ–¹æ³•æ¥è¡¨è¾¾è¿™ç§å·®å¼‚
public abstract class AlertHandler {
  protected AlertRule rule;
  protected Notification notification;
  public AlertHandler(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }
  public abstract void check(ApiStatInfo apiStatInfo);
}

//å…·ä½“å¤„ç†checkçš„é€»è¾‘
public class TpsAlertHandler extends AlertHandler {
  public TpsAlertHandler(AlertRule rule, Notification notification) {
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    long tps = apiStatInfo.getRequestCount()/ apiStatInfo.getDurationOfSeconds();
    if (tps > rule.getMatchedRule(apiStatInfo.getApi()).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, "...");
    }
  }
}

////å…·ä½“å¤„ç†checkçš„é€»è¾‘
public class ErrorAlertHandler extends AlertHandler {
  public ErrorAlertHandler(AlertRule rule, Notification notification){
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    if (apiStatInfo.getErrorCount() > rule.getMatchedRule(apiStatInfo.getApi()).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, "...");
    }
  }
}


public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    //å‘alertæ³¨å†Œhandle
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
  }
  public Alert getAlert() { return alert; }

  // é¥¿æ±‰å¼å•ä¾‹
  private static final ApplicationContext instance = new ApplicationContext();
  private ApplicationContext() {
    initializeBeans();
  }
  public static ApplicationContext getInstance() {
    return instance;
  }
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥è®¾ç½®apiStatInfoæ•°æ®å€¼çš„ä»£ç 
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
  }
}
~~~

å¦‚æœå†æ·»åŠ ä¸Šé¢è®²åˆ°çš„é‚£ä¸ªæ–°åŠŸèƒ½ï¼Œæ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æŸä¸ªæœ€å¤§é˜ˆå€¼å°±å‘Šè­¦ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•æ”¹åŠ¨ä»£ç å‘¢ï¼Ÿ

~~~java
public class Alert { // ä»£ç æœªæ”¹åŠ¨... }
public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
  private long timeoutCount; // æ”¹åŠ¨ä¸€ï¼šæ·»åŠ æ–°å­—æ®µ
}
public abstract class AlertHandler { //ä»£ç æœªæ”¹åŠ¨... }
public class TpsAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
public class ErrorAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
// æ”¹åŠ¨äºŒï¼šæ·»åŠ æ–°çš„handler
public class TimeoutAlertHandler extends AlertHandler {//çœç•¥ä»£ç ...}

public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
    // æ”¹åŠ¨ä¸‰ï¼šæ³¨å†Œhandler
    alert.addAlertHandler(new TimeoutAlertHandler(alertRule, notification));
  }
  //...çœç•¥å…¶ä»–æœªæ”¹åŠ¨ä»£ç ...
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥apiStatInfoçš„setå­—æ®µä»£ç 
    apiStatInfo.setTimeoutCount(289); // æ”¹åŠ¨å››ï¼šè®¾ç½®tiemoutCountå€¼
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
}

~~~

åœ¨æ·»åŠ æ–°çš„å‘Šè­¦é€»è¾‘çš„æ—¶å€™ï¼Œå°½ç®¡æ”¹åŠ¨äºŒï¼ˆæ·»åŠ æ–°çš„handlerç±»ï¼‰æ˜¯åŸºäºæ‰©å±•è€Œéä¿®æ”¹çš„æ–¹å¼æ¥å®Œæˆçš„ï¼Œä½†æ”¹åŠ¨ä¸€ã€ä¸‰ã€å››è²Œä¼¼ä¸æ˜¯åŸºäºæ‰©å±•è€Œæ˜¯åŸºäºä¿®æ”¹çš„æ–¹å¼æ¥å®Œæˆçš„ï¼Œé‚£æ”¹åŠ¨ä¸€ã€ä¸‰ã€å››ä¸å°±è¿èƒŒäº†å¼€é—­åŸåˆ™å—ï¼Ÿ

å¼€é—­åŸåˆ™å¯ä»¥åº”ç”¨åœ¨ä¸åŒç²’åº¦çš„ä»£ç ä¸­ï¼Œå¯ä»¥æ˜¯æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ç±»ï¼Œè¿˜å¯ä»¥æ˜¯æ–¹æ³•ï¼ˆåŠå…¶å±æ€§ï¼‰ã€‚åŒæ ·ä¸€ä¸ªä»£ç æ”¹åŠ¨ï¼Œåœ¨ç²—ä»£ç ç²’åº¦ä¸‹ï¼Œè¢«è®¤å®šä¸ºâ€œä¿®æ”¹â€ï¼Œåœ¨ç»†ä»£ç ç²’åº¦ä¸‹ï¼Œåˆå¯ä»¥è¢«è®¤å®šä¸ºâ€œæ‰©å±•â€ã€‚é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªä»£ç æ”¹åŠ¨æ˜¯å¦è¿èƒŒäº†å¼€æ”¾åŸåˆ™ï¼Ÿæˆ‘ä»¬è¦å›åˆ°è¿™æ¡åŸåˆ™çš„è®¾è®¡åˆè¡·ï¼š**åªè¦å®ƒæ²¡æœ‰ç ´ååŸæœ‰çš„ä»£ç çš„æ­£å¸¸è¿è¡Œï¼Œæ²¡æœ‰ç ´ååŸæœ‰çš„å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ ¼çš„ä»£ç æ”¹åŠ¨**ã€‚

æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä¸å¯èƒ½ä»»ä½•æ¨¡å—ã€ç±»ã€æ–¹æ³•çš„ä»£ç éƒ½ä¸â€œä¿®æ”¹â€ï¼Œè¿™ä¸ªæ˜¯åšä¸åˆ°çš„ã€‚ç±»éœ€è¦åˆ›å»ºã€ç»„è£…ã€å¹¶ä¸”åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ‰èƒ½æ„å»ºæˆå¯è¿è¡Œçš„çš„ç¨‹åºï¼Œè¿™éƒ¨åˆ†ä»£ç çš„ä¿®æ”¹æ˜¯åœ¨æ‰€éš¾å…çš„ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯å°½é‡è®©ä¿®æ”¹æ“ä½œæ›´é›†ä¸­ï¼Œå°½é‡è®©æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„é‚£éƒ¨åˆ†é€»è¾‘ä»£ç æ»¡è¶³å¼€é—­åŸåˆ™ã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼Œ**å¼€é—­åŸåˆ™å¹¶ä¸æ˜¯è¯´å®Œå…¨æœç»ä¿®æ”¹ï¼Œè€Œæ˜¯ä»¥æœ€å°çš„ä¿®æ”¹ä»£ç çš„ä»£ä»·æ¥å®Œæˆæ–°åŠŸèƒ½çš„å¼€å‘ã€‚**

æˆ‘ä»¬æ ¹æ®ç°æœ‰çš„éœ€æ±‚ï¼Œå»æ”¯æŒæ‰©å±•ç‚¹å³å¯ï¼Œ**æ²¡å¿…è¦ä¸ºå°†æ¥å¯èƒ½è¦å®ç°çš„éœ€æ±‚æå‰ä¹°å•ï¼Œåšè¿‡åº¦è®¾è®¡**ã€‚ç­‰åˆ°ä»¥åæœ‰éœ€æ±‚é©±åŠ¨çš„æ—¶å€™ï¼Œå†é€šè¿‡é‡æ„ä»£ç çš„æ–¹å¼æ¥å®ç°æ‰©å±•çš„éœ€æ±‚ã€‚æ­¤å¤–ï¼Œå¼€é—­åŸåˆ™ä¹Ÿå¹¶ä¸æ˜¯å…è´¹çš„ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œä»£ç çš„æ‰©å±•æ€§ä¼šè·Ÿå¯è¯»æ€§ç›¸å†²çªï¼ˆä¸Šé¢Alertå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼‰ã€‚

## é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰

è¿™ä¸ªåŸåˆ™æœ€æ—©æ˜¯åœ¨1986å¹´ç”±Barbara Liskovæå‡ºï¼Œä»–æ˜¯è¿™ä¹ˆæè¿°è¿™æ¡åŸåˆ™çš„

> If S is a subtype of T, then objects of type T may be replaced with objects of type S, without breaking the program
>
> å­ç±»å¯¹è±¡èƒ½å¤Ÿæ›¿æ¢ç¨‹åºä¸­çˆ¶ç±»å¯¹è±¡å‡ºç°çš„ä»»ä½•åœ°æ–¹ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚

åœ¨1996å¹´ï¼ŒRobert Martinåœ¨ä»–çš„SOLIDåŸåˆ™ä¸­ï¼Œé‡æ–°æè¿°äº†è¿™ä¸ªåŸåˆ™

>Functions that use pointers of references to base classes must be able to use objects of derived classes without knowing itã€‚



~~~java
//çˆ¶ç±»Transporterä½¿ç”¨org.apache.httpåº“ä¸­çš„HttpClientç±»æ¥ä¼ è¾“ç½‘ç»œæ•°æ®ã€‚
public class Transporter {
  private HttpClient httpClient;
  
  public Transporter(HttpClient httpClient) {
    this.httpClient = httpClient;
  }

  public Response sendRequest(Request request) {
    // ...use httpClient to send request
  }
}

//å­ç±»SecurityTransporterç»§æ‰¿çˆ¶ç±»Transporterï¼Œå¢åŠ äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæ”¯æŒä¼ è¾“appIdå’ŒappTokenå®‰å…¨è®¤è¯ä¿¡æ¯ã€‚
public class SecurityTransporter extends Transporter {
  private String appId;
  private String appToken;

  public SecurityTransporter(HttpClient httpClient, String appId, String appToken) {
    super(httpClient);
    this.appId = appId;
    this.appToken = appToken;
  }

  @Override
  public Response sendRequest(Request request) {
    if (StringUtils.isNotBlank(appId) && StringUtils.isNotBlank(appToken)) {
      request.addPayload("app-id", appId);
      request.addPayload("app-token", appToken);
    }
    return super.sendRequest(request);
  }
}

public class Demo {    
  public void demoFunction(Transporter transporter) {    
    Reuqest request = new Request();
    //...çœç•¥è®¾ç½®requestä¸­æ•°æ®å€¼çš„ä»£ç ...
    Response response = transporter.sendRequest(request);
    //...çœç•¥å…¶ä»–é€»è¾‘...
  }
}


Demo demo = new Demo();
// å­ç±»SecurityTransporterçš„è®¾è®¡å®Œå…¨ç¬¦åˆé‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥æ›¿æ¢çˆ¶ç±»å‡ºç°çš„ä»»ä½•ä½ç½®
demo.demofunction(new SecurityTransporter(/*çœç•¥å‚æ•°*/););
~~~

ä¹ä¸€çœ‹ï¼Œè¿™ä¸å°±æ˜¯å¤šæ€å—ï¼Œå®é™…ä¸Šè¿˜æ˜¯æœ‰æ‰€å·®åˆ«çš„ã€‚å‡å¦‚æˆ‘ä»¬è¿™æ ·å®ç°SecurityTransporterå­ç±»

~~~java
public class SecurityTransporter extends Transporter {
  //...çœç•¥å…¶ä»–ä»£ç ..
  @Override
  public Response sendRequest(Request request) {
    //å¦‚æœappIdæˆ–è€…appTokenæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ç›´æ¥æŠ›å‡ºNoAuthorizationRuntimeExceptionæœªæˆæƒå¼‚å¸¸
    if (StringUtils.isBlank(appId) || StringUtils.isBlank(appToken)) {
      throw new NoAuthorizationRuntimeException(...);
    }
    request.addPayload("app-id", appId);
    request.addPayload("app-token", appToken);
    return super.sendRequest(request);
  }
}
~~~

æ­¤æ—¶ï¼Œå¦‚æœä¼ é€’è¿›demoFunction()å‡½æ•°çš„æ˜¯çˆ¶ç±»Transporterå¯¹è±¡ï¼Œé‚£demoFunction()å‡½æ•°å¹¶ä¸ä¼šæœ‰å¼‚å¸¸æŠ›å‡ºï¼Œä½†å¦‚æœä¼ é€’ç»™demoFunction()å‡½æ•°çš„æ˜¯å­ç±»SecurityTransporterå¯¹è±¡ï¼Œé‚£demoFunction()æœ‰å¯èƒ½ä¼šæœ‰å¼‚å¸¸æŠ›å‡ºã€‚æ•´ä¸ªç¨‹åºçš„é€»è¾‘è¡Œä¸ºæœ‰äº†æ”¹å˜ã€‚

å®é™…ä¸Šï¼Œé‡Œå¼æ›¿æ¢åŸåˆ™è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ›´åŠ èƒ½è½åœ°ã€æ›´æœ‰æŒ‡å¯¼æ„ä¹‰çš„æè¿°ï¼Œé‚£å°±æ˜¯**â€œDesign By Contractâ€ï¼ˆæŒ‰ç…§åè®®æ¥è®¾è®¡ï¼‰**

å­ç±»åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œè¦éµå®ˆçˆ¶ç±»çš„è¡Œä¸ºçº¦å®šï¼ˆæˆ–è€…å«åè®®ï¼‰ã€‚å¦‚æœçˆ¶ç±»å®šä¹‰äº†å‡½æ•°çš„è¡Œä¸ºçº¦å®šï¼Œé‚£å­ç±»ä¸èƒ½æ”¹å˜å‡½æ•°åŸæœ‰çš„è¡Œä¸ºçº¦å®šï¼Œä½†å¯ä»¥æ”¹å˜å‡½æ•°çš„å†…éƒ¨å®ç°é€»è¾‘ã€‚è¿™é‡Œçš„è¡Œä¸ºçº¦å®šåŒ…æ‹¬ï¼šå‡½æ•°å£°æ˜è¦å®ç°çš„åŠŸèƒ½ï¼›å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®šï¼›ç”šè‡³åŒ…æ‹¬æ³¨é‡Šä¸­æ‰€ç½—åˆ—çš„ä»»ä½•ç‰¹æ®Šè¯´æ˜ã€‚



## æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰

> Clients should not be forced to depend upon interfaces that they do not use
>
> ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ç«¯ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£

åœ¨è¿™æ¡åŸåˆ™ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠâ€œæ¥å£â€ç†è§£ä¸ºä¸‹é¢ä¸‰ç§ä¸œè¥¿ï¼š

*   ä¸€ç»„APIæ¥å£é›†åˆ
*   å•ä¸ªAPIæ¥å£æˆ–å‡½æ•°
*   OOPä¸­çš„æ¥å£æ¦‚å¿µ

æ¥å£éš”ç¦»åŸåˆ™è·Ÿå•ä¸€èŒè´£åŸåˆ™æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ã€‚æ¥å£éš”ç¦»åŸåˆ™ç›¸å¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œå®ƒæ›´ä¾§é‡å•ä¸€èŒè´£é‡Œçš„æ¥å£è®¾è®¡ï¼Œå¹¶ä¸”å®ƒçš„æ€è€ƒçš„è§’åº¦ä¸åŒï¼Œå³é€šè¿‡è€ƒè™‘è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£ï¼Œæ¥é—´æ¥åœ°åˆ¤å®šæ¥å£æ˜¯å¦èŒè´£å•ä¸€ã€‚å¦‚æœè°ƒç”¨è€…åªä½¿ç”¨éƒ¨åˆ†æ¥å£æˆ–æ¥å£çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æ¥å£çš„è®¾è®¡å°±ä¸å¤ŸèŒè´£å•ä¸€ã€‚

æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«æŒ‰ç…§ä¸åŒçš„ç†è§£æ–¹å¼ï¼Œæ¥è§£è¯»è¿™æ¡åŸåˆ™ï¼š

### â€œæ¥å£â€ç†è§£ä¸ºä¸€ç»„æ¥å£é›†åˆ

~~~java
//å¾®æœåŠ¡ç”¨æˆ·ç³»ç»Ÿæä¾›äº†ä¸€ç»„è·Ÿç”¨æˆ·ç›¸å…³çš„APIç»™å…¶ä»–ç³»ç»Ÿä½¿ç”¨

public interface UserService {
  boolean register(String cellphone, String password);
  boolean login(String cellphone, String password);
  UserInfo getUserInfoById(long id);
  UserInfo getUserInfoByCellphone(String cellphone);
}

public class UserServiceImpl implements UserService {
  //...
}
~~~

å¦‚æœç°åœ¨æœ‰åˆ é™¤ç”¨æˆ·çš„éœ€æ±‚ï¼Œé‚£ä¹ˆç®€å•ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨UserServiceä¸­æ–°æ·»åŠ ä¸€ä¸ªdeleteUserByCellphone()æˆ–deleteUserById()æ¥å£ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿéšè—äº†ä¸€äº›å®‰å…¨éšæ‚£ã€‚åˆ é™¤ç”¨æˆ·æ˜¯ä¸€ä¸ªéå¸¸æ…é‡çš„æ“ä½œï¼Œæˆ‘ä»¬åªå¸Œæœ›é€šè¿‡åå°ç®¡ç†ç³»ç»Ÿæ¥æ‰§è¡Œï¼Œè€Œä¸æ˜¯æ‰€æœ‰ä½¿ç”¨åˆ°UserServiceçš„ç³»ç»Ÿã€‚æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»æ¶æ„è®¾è®¡çš„å±‚é¢ï¼Œé€šè¿‡æ¥å£é‰´æƒçš„æ–¹å¼æ¥é™åˆ¶æ¥å£çš„è°ƒç”¨ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä»ä»£ç è®¾è®¡çš„å±‚é¢ï¼Œå‚ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œå°†åˆ é™¤æ¥å£å•ç‹¬æ”¾åˆ°å¦å¤–ä¸€ä¸ªæ¥å£RestrictedUserServiceä¸­ã€‚

~~~java
public interface UserService {
  boolean register(String cellphone, String password);
  boolean login(String cellphone, String password);
  UserInfo getUserInfoById(long id);
  UserInfo getUserInfoByCellphone(String cellphone);
}

public interface RestrictedUserService {
  boolean deleteUserByCellphone(String cellphone);
  boolean deleteUserById(long id);
}

public class UserServiceImpl implements UserService, RestrictedUserService {
  // ...çœç•¥å®ç°ä»£ç ...
}
~~~

### â€œæ¥å£â€ç†è§£ä¸ºå•ä¸ªAPIæ¥å£æˆ–å‡½æ•°

æ­¤æ—¶ï¼Œé‚£æ¥å£éš”ç¦»åŸåˆ™å°±å¯ä»¥ç†è§£ä¸ºï¼šå‡½æ•°çš„è®¾è®¡è¦åŠŸèƒ½å•ä¸€ï¼Œä¸è¦å°†å¤šä¸ªä¸åŒçš„åŠŸèƒ½é€»è¾‘åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®ç°ã€‚

~~~java
public class Statistics {
  private Long max;
  private Long min;
  private Long average;
  private Long sum;
  private Long percentile99;
  private Long percentile999;
  //...çœç•¥constructor/getter/setterç­‰æ–¹æ³•...
}

public Statistics count(Collection<Long> dataSet) {
  Statistics statistics = new Statistics();
  //...çœç•¥è®¡ç®—é€»è¾‘...
  return statistics;
}

~~~

count()åŒ…å«å¾ˆå¤šä¸åŒçš„ç»Ÿè®¡åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œæ±‚æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰ç­‰ã€‚æŒ‰ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠcount()å‡½æ•°æ‹†æˆå‡ ä¸ªæ›´å°ç²’åº¦çš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°è´Ÿè´£ä¸€ä¸ªç‹¬ç«‹çš„ç»Ÿè®¡åŠŸèƒ½ã€‚æ‹†åˆ†ä¹‹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

~~~java
public Long max(Collection<Long> dataSet) { //... }
public Long min(Collection<Long> dataSet) { //... } 
public Long average(Colletion<Long> dataSet) { //... }
// ...çœç•¥å…¶ä»–ç»Ÿè®¡å‡½æ•°...
~~~

### â€œæ¥å£â€ç†è§£ä¸ºOOPä¸­çš„æ¥å£

å‡è®¾é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ä¸ªå¤–éƒ¨ç³»ç»Ÿï¼šRedisã€MySQLã€Kafkaã€‚æ¯ä¸ªç³»ç»Ÿéƒ½å¯¹åº”ä¸€ç³»åˆ—é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚åœ°å€ã€ç«¯å£ã€è®¿é—®è¶…æ—¶æ—¶é—´ç­‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¾è®¡å®ç°äº†ä¸‰ä¸ªConfigurationç±»ï¼šRedisConfigã€MysqlConfigã€KafkaConfigï¼š

~~~java
public class RedisConfig {
    private ConfigSource configSource; 	//é…ç½®ä¸­å¿ƒï¼ˆæ¯”å¦‚zookeeperï¼‰
    private String address;
    private int timeout;
    private int maxTotal;
    //çœç•¥å…¶ä»–é…ç½®: maxWaitMillis,maxIdle,minIdle...

    public RedisConfig(ConfigSource configSource) {
        this.configSource = configSource;
    }

    public String getAddress() {
        return this.address;
    }
    //...çœç•¥å…¶ä»–get()ã€init()æ–¹æ³•...

    public void update() {
      //ä»configSourceåŠ è½½é…ç½®åˆ°address/timeout/maxTotal...
    }
}

public class KafkaConfig { //...çœç•¥... }
public class MysqlConfig { //...çœç•¥... }
~~~

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„åŠŸèƒ½éœ€æ±‚ï¼Œå¸Œæœ›æ”¯æŒRediså’ŒKafkaé…ç½®ä¿¡æ¯çš„çƒ­æ›´æ–°ã€‚æ‰€è°“**â€œçƒ­æ›´æ–°ï¼ˆhot updateï¼‰â€**å°±æ˜¯ï¼šå¦‚æœåœ¨é…ç½®ä¸­å¿ƒé‡Œæ›´æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œåœ¨ä¸ç”¨é‡å¯ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œå°±èƒ½å°†æœ€æ–°çš„é…ç½®ä¿¡æ¯åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å¯¹MySQLçš„é…ç½®ä¿¡æ¯è¿›è¡Œçƒ­æ›´æ–°ã€‚

ä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å®ç°äº†ä¸€ä¸ªScheduledUpdaterç±»ï¼Œä»¥å›ºå®šæ—¶é—´é¢‘ç‡ï¼ˆperiodInSecondsï¼‰æ¥è°ƒç”¨RedisConfigã€KafkaConfigçš„update()æ–¹æ³•æ›´æ–°é…ç½®ä¿¡æ¯ï¼š

~~~java
public interface Updater {
  void update();
}

public class RedisConfig implemets Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class KafkaConfig implements Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class MysqlConfig { //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•... }

public class ScheduledUpdater {
	//çº¿ç¨‹æ± 
    private final ScheduledExecutorService executor = Executors.newSingleThreadScheduledExecutor();;
    private long initialDelayInSeconds;
    private long periodInSeconds;
    private Updater updater;

    public ScheduleUpdater(Updater updater, long initialDelayInSeconds, long periodInSeconds) {
        this.updater = updater;
        this.initialDelayInSeconds = initialDelayInSeconds;
        this.periodInSeconds = periodInSeconds;
    }

    public void run() {
        executor.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                updater.update();
            }
        }, this.initialDelayInSeconds, this.periodInSeconds, TimeUnit.SECONDS);
    }
}

public class Application {
  ConfigSource configSource = new ZookeeperConfigSource(/*çœç•¥å‚æ•°*/);
  public static final RedisConfig redisConfig = new RedisConfig(configSource);
  public static final KafkaConfig kafkaConfig = new KakfaConfig(configSource);
  public static final MySqlConfig mysqlConfig = new MysqlConfig(configSource);

  public static void main(String[] args) {
    ScheduledUpdater redisConfigUpdater = new ScheduledUpdater(redisConfig, 300, 300);
    redisConfigUpdater.run();
    
  
    ScheduledUpdater kafkaConfigUpdater = new ScheduledUpdater(kafkaConfig, 60, 60);
    kafkaConfigUpdater.run();
  }
}

~~~

ç°åœ¨ï¼Œæˆ‘ä»¬åˆæœ‰äº†ä¸€ä¸ªæ–°çš„ç›‘æ§åŠŸèƒ½éœ€æ±‚ã€‚é€šè¿‡å‘½ä»¤è¡Œæ¥æŸ¥çœ‹Zookeeperä¸­çš„é…ç½®ä¿¡æ¯æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼€å‘ä¸€ä¸ªå†…åµŒçš„SimpleHttpServerï¼Œè¾“å‡ºé¡¹ç›®çš„é…ç½®ä¿¡æ¯åˆ°ä¸€ä¸ªå›ºå®šçš„HTTPåœ°å€ï¼Œæ¯”å¦‚ï¼š[http://127.0.0.1:2389/config](http://127.0.0.1:2389/config) ã€‚ä¸è¿‡ï¼Œå‡ºäºæŸäº›åŸå› ï¼Œæˆ‘ä»¬åªæƒ³æš´éœ²MySQLå’ŒRedisçš„é…ç½®ä¿¡æ¯ï¼Œä¸æƒ³æš´éœ²Kafkaçš„é…ç½®ä¿¡æ¯ã€‚

~~~java
public interface Updater {
  void update();
}

public interface Viewer {
  String outputInPlainText();
  Map<String, String> output();
}

public class RedisConfig implemets Updater, Viewer {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
  @Override
  public String outputInPlainText() { //... }
  @Override
  public Map<String, String> output() { //...}
}

public class KafkaConfig implements Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class MysqlConfig implements Viewer {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public String outputInPlainText() { //... }
  @Override
  public Map<String, String> output() { //...}
}

public class SimpleHttpServer {
  private String host;
  private int port;
  private Map<String, List<Viewer>> viewers = new HashMap<>();
  
  public SimpleHttpServer(String host, int port) {//...}
  
  public void addViewers(String urlDirectory, Viewer viewer) {
    if (!viewers.containsKey(urlDirectory)) {
      viewers.put(urlDirectory, new ArrayList<Viewer>());
    }
    this.viewers.get(urlDirectory).add(viewer);
  }
  
  public void run() { //... }
}

public class Application {
    ConfigSource configSource = new ZookeeperConfigSource();
    public static final RedisConfig redisConfig = new RedisConfig(configSource);
    public static final KafkaConfig kafkaConfig = new KakfaConfig(configSource);
    public static final MySqlConfig mysqlConfig = new MySqlConfig(configSource);
    
    public static void main(String[] args) {
        ScheduledUpdater redisConfigUpdater =
            new ScheduledUpdater(redisConfig, 300, 300);
        redisConfigUpdater.run();
        
        ScheduledUpdater kafkaConfigUpdater =
            new ScheduledUpdater(kafkaConfig, 60, 60);
        redisConfigUpdater.run();
        
        SimpleHttpServer simpleHttpServer = new SimpleHttpServer(â€œ127.0.0.1â€, 2389);
        simpleHttpServer.addViewer("/config", redisConfig);
        simpleHttpServer.addViewer("/config", mysqlConfig);
        simpleHttpServer.run();
    }
}
~~~

Updaterå’ŒVieweræ¥å£éƒ½æ˜¯èŒè´£å•ä¸€çš„ï¼Œæ»¡è¶³æ¥å£éš”ç¦»åŸåˆ™ã€‚

## ä¾èµ–åè½¬åŸåˆ™

### æ§åˆ¶åè½¬

åœ¨ä»‹ç»ä¾èµ–åè½¬åŸåˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†**â€œæ§åˆ¶åè½¬â€ï¼ˆInversion Of Controlï¼‰**ã€‚è¿™é‡Œçš„â€œæ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œâ€œåè½¬â€æŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæµç¨‹å¯ä»¥é€šè¿‡æ¡†æ¶æ¥æ§åˆ¶ã€‚æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜â€œåè½¬â€åˆ°äº†æ¡†æ¶ã€‚

~~~java
public class UserServiceTest {
  public static boolean doTest() {
    // ... 
  }
  
  public static void main(String[] args) {//è¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥æ”¾åˆ°æ¡†æ¶ä¸­
    if (doTest()) {
      System.out.println("Test succeed.");
    } else {
      System.out.println("Test failed.");
    }
  }
}

~~~

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰çš„æµç¨‹éƒ½ç”±ç¨‹åºå‘˜æ¥æ§åˆ¶ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªè¿™æ ·ä¸€ä¸ªæ¡†æ¶ï¼š

~~~java
public abstract class TestCase {
  public void run() {
    if (doTest()) {
      System.out.println("Test succeed.");
    } else {
      System.out.println("Test failed.");
    }
  }
  
  public abstract boolean doTest();
}

public class JunitApplication {
  private static final List<TestCase> testCases = new ArrayList<>();
  
  public static void register(TestCase testCase) {
    testCases.add(testCase);
  }
  
  public static final void main(String[] args) {
    for (TestCase case: testCases) {
      case.run();
    }
  }
}
~~~

æŠŠè¿™ä¸ªç®€åŒ–ç‰ˆæœ¬çš„æµ‹è¯•æ¡†æ¶å¼•å…¥åˆ°å·¥ç¨‹ä¸­ä¹‹åï¼Œæˆ‘ä»¬å‘doTestå¡«å……å…·ä½“çš„æµ‹è¯•ä»£ç å³å¯ï¼Œè€Œæ— éœ€è€ƒè™‘ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼š

~~~java
public class UserServiceTest extends TestCase {
  @Override
  public boolean doTest() {
    // ... 
  }
}

// æ³¨å†Œæ“ä½œè¿˜å¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼æ¥å®ç°ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºè°ƒç”¨register()
JunitApplication.register(new UserServiceTest();
~~~

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œæ¥å®ç°äº†æ§åˆ¶åè½¬ã€‚æ­¤å¤–ï¼Œæ§åˆ¶åè½¬ä¹Ÿå¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ç­‰æ–¹æ³•æ¥å®ç°ã€‚

### ä¾èµ–æ³¨å…¥

**ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰**ï¼šä¸é€šè¿‡new()çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–æ³¨å…¥ï¼‰ç»™ç±»ä½¿ç”¨ã€‚

æˆ‘ä»¬ç°åœ¨è¦è®¾è®¡è´Ÿè´£æ¶ˆæ¯æ¨é€çš„Notificationç±»ã€‚å®ƒä¾èµ–MessageSenderç±»ï¼Œæ¥å®ç°æ¨é€å•†å“ä¿ƒé”€ã€éªŒè¯ç ç­‰æ¶ˆæ¯ç»™ç”¨æˆ·çš„åŠŸèƒ½ã€‚æˆ‘ä»¬åˆ†åˆ«ç”¨ä¾èµ–æ³¨å…¥å’Œéä¾èµ–æ³¨å…¥ä¸¤ç§æ–¹å¼æ¥å®ç°ä¸€ä¸‹ï¼š

~~~java
// éä¾èµ–æ³¨å…¥å®ç°æ–¹å¼
public class Notification {
  private MessageSender messageSender;
  
  public Notification() {
    this.messageSender = new MessageSender(); //æ­¤å¤„æœ‰ç‚¹åƒhardcode
  }
  
  public void sendMessage(String cellphone, String message) {
    //...çœç•¥æ ¡éªŒé€»è¾‘ç­‰...
    this.messageSender.send(cellphone, message);
  }
}

public class MessageSender {
  public void send(String cellphone, String message) {
    //....
  }
}
// ä½¿ç”¨Notification
Notification notification = new Notification();
~~~



~~~java
// ä¾èµ–æ³¨å…¥çš„å®ç°æ–¹å¼
public class Notification {
  private MessageSender messageSender;
  
  // é€šè¿‡æ„é€ å‡½æ•°å°†messageSenderä¼ é€’è¿›æ¥
  public Notification(MessageSender messageSender) {
    this.messageSender = messageSender;
  }
  
  public void sendMessage(String cellphone, String message) {
    //...çœç•¥æ ¡éªŒé€»è¾‘ç­‰...
    this.messageSender.send(cellphone, message);
  }
}
//ä½¿ç”¨Notification
MessageSender messageSender = new MessageSender();
Notification notification = new Notification(messageSender);
~~~

ä¾èµ–æ³¨å…¥çš„å®ç°æ–¹å¼æé«˜äº†ä»£ç çš„æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»åœ°æ›¿æ¢ä¾èµ–çš„ç±»ï¼Œè¿™æ˜¯ç¬¦åˆå¼€é—­åŸåˆ™çš„ã€‚åˆ›å»ºå¯¹è±¡ã€ç»„è£…ï¼ˆæˆ–æ³¨å…¥ï¼‰å¯¹è±¡çš„å·¥ä½œä»…ä»…æ˜¯ç”±æ›´ä¸Šå±‚ä»£ç æ¥è´Ÿè´£è€Œå·²ï¼Œè¿™è¿˜æ˜¯éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆè¿™äº›å·¥ä½œï¼š

~~~java
public class Demo {
  public static final void main(String args[]) {
    MessageSender sender = new SmsSender(); //åˆ›å»ºå¯¹è±¡
    Notification notification = new Notification(sender);//ä¾èµ–æ³¨å…¥
    notification.sendMessage("13918942177", "çŸ­ä¿¡éªŒè¯ç ï¼š2346");
  }
}
~~~

åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸€äº›é¡¹ç›®å¯èƒ½ä¼šæ¶‰åŠå‡ åã€ä¸Šç™¾ã€ç”šè‡³å‡ ç™¾ä¸ªç±»ï¼Œç±»å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ä¼šå˜å¾—éå¸¸å¤æ‚ã€‚è€Œå¯¹è±¡åˆ›å»ºå’Œä¾èµ–æ³¨å…¥çš„å·¥ä½œï¼Œæœ¬èº«è·Ÿå…·ä½“çš„ä¸šåŠ¡æ— å…³ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠ½è±¡æˆæ¡†æ¶æ¥è‡ªåŠ¨å®Œæˆã€‚

å®é™…ä¸Šï¼Œç°æˆçš„ä¾èµ–æ³¨å…¥æ¡†æ¶æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Google Guiceã€Java Springã€Pico Containerã€Butterfly Containerç­‰ã€‚

### ä¾èµ–åè½¬åŸåˆ™

>High-level modules shouldnâ€™t depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldnâ€™t depend on details. Details depend on abstractions.
>
>é«˜å±‚æ¨¡å—ä¸è¦ä¾èµ–ä½å±‚æ¨¡å—ã€‚é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—åº”è¯¥é€šè¿‡æŠ½è±¡æ¥äº’ç›¸ä¾èµ–ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒæŠ½è±¡ä¸è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚



æ‰€è°“é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—çš„åˆ’åˆ†ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œåœ¨è°ƒç”¨é“¾ä¸Šï¼Œè°ƒç”¨è€…å±äºé«˜å±‚ï¼Œè¢«è°ƒç”¨è€…å±äºä½å±‚ã€‚åœ¨å¹³æ—¶çš„ä¸šåŠ¡ä»£ç å¼€å‘ä¸­ï¼Œé«˜å±‚æ¨¡å—ä¾èµ–åº•å±‚æ¨¡å—æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚å®é™…ä¸Šï¼Œè¿™æ¡åŸåˆ™ä¸»è¦è¿˜æ˜¯ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚æˆ‘ä»¬æ‹¿Tomcatè¿™ä¸ªServletå®¹å™¨ä½œä¸ºä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚

æŒ‰ç…§ä¹‹å‰çš„åˆ’åˆ†åŸåˆ™ï¼ŒTomcatå°±æ˜¯é«˜å±‚æ¨¡å—ï¼Œæˆ‘ä»¬ç¼–å†™çš„Webåº”ç”¨ç¨‹åºä»£ç å°±æ˜¯ä½å±‚æ¨¡å—ã€‚Tomcatå’Œåº”ç”¨ç¨‹åºä»£ç ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œä¸¤è€…éƒ½ä¾èµ–åŒä¸€ä¸ªâ€œæŠ½è±¡â€ï¼Œä¹Ÿå°±æ˜¯Servletè§„èŒƒã€‚Servletè§„èŒƒä¸ä¾èµ–å…·ä½“çš„Tomcatå®¹å™¨å’Œåº”ç”¨ç¨‹åºçš„å®ç°ç»†èŠ‚ï¼Œè€ŒTomcatå®¹å™¨å’Œåº”ç”¨ç¨‹åºä¾èµ–Servletè§„èŒƒã€‚

è¿™ä¸ªè§„èŒƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå°†ä¸¤ä¸ªå˜åŒ–çš„éƒ¨åˆ†éš”ç¦»å¼€æ¥ï¼Œè‡ªèº«æ˜¯ä¸€ä¸ªä¸å˜çš„éƒ¨åˆ†ã€‚

## KISS

KISSåŸåˆ™çš„è‹±æ–‡æè¿°æœ‰å¥½å‡ ä¸ªç‰ˆæœ¬

>*   Keep It Simple and Stupid.
>*   Keep It Short and Simple.
>*   Keep It Simple and Straightforward

å®ƒä»¬çš„æ ¸å¿ƒæ„æ€éƒ½æ˜¯ï¼šå°½é‡ä¿æŒç®€å•ã€‚

KISSåŸåˆ™å°±æ˜¯ä¿æŒä»£ç å¯è¯»å’Œå¯ç»´æŠ¤çš„é‡è¦æ‰‹æ®µã€‚ä»£ç è¶³å¤Ÿç®€å•ï¼Œä¹Ÿå°±æ„å‘³ç€å¾ˆå®¹æ˜“è¯»æ‡‚ï¼Œå³ä¾¿å‡ºç°bugï¼Œä¿®å¤èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ä¸è¦è§‰å¾—ç®€å•çš„ä¸œè¥¿å°±æ²¡æœ‰æŠ€æœ¯å«é‡ã€‚å®é™…ä¸Šï¼Œè¶Šæ˜¯èƒ½ç”¨ç®€å•çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œè¶Šèƒ½ä½“ç°ä¸€ä¸ªäººçš„èƒ½åŠ›ã€‚

### ä»£ç è¡Œæ•°è¶Šå°‘è¶Šç®€å•å—ï¼Ÿ

ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œæ£€æŸ¥è¾“å…¥çš„å­—ç¬¦ä¸²ipAddressæ˜¯å¦æ˜¯åˆæ³•çš„IPåœ°å€ï¼š

~~~java
// ç¬¬ä¸€ç§å®ç°æ–¹å¼: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
public boolean isValidIpAddressV1(String ipAddress) {
  if (StringUtils.isBlank(ipAddress)) return false;
  String regex = "^(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\."
          + "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."
          + "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."
          + "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$";
  return ipAddress.matches(regex);
}

// ç¬¬äºŒç§å®ç°æ–¹å¼: ä½¿ç”¨ç°æˆçš„å·¥å…·ç±»
public boolean isValidIpAddressV2(String ipAddress) {
  if (StringUtils.isBlank(ipAddress)) return false;
  String[] ipUnits = StringUtils.split(ipAddress, '.');
  if (ipUnits.length != 4) {
    return false;
  }
  for (int i = 0; i < 4; ++i) {
    int ipUnitIntValue;
    try {
      ipUnitIntValue = Integer.parseInt(ipUnits[i]);
    } catch (NumberFormatException e) {
      return false;
    }
    if (ipUnitIntValue < 0 || ipUnitIntValue > 255) {
      return false;
    }
    if (i == 0 && ipUnitIntValue == 0) {
      return false;
    }
  }
  return true;
}

// ç¬¬ä¸‰ç§å®ç°æ–¹å¼: ä¸ä½¿ç”¨ä»»ä½•å·¥å…·ç±»
public boolean isValidIpAddressV3(String ipAddress) {
  char[] ipChars = ipAddress.toCharArray();
  int length = ipChars.length;
  int ipUnitIntValue = -1;
  boolean isFirstUnit = true;
  int unitsCount = 0;
  for (int i = 0; i < length; ++i) {
    char c = ipChars[i];
    if (c == '.') {
      if (ipUnitIntValue < 0 || ipUnitIntValue > 255) return false;
      if (isFirstUnit && ipUnitIntValue == 0) return false;
      if (isFirstUnit) isFirstUnit = false;
      ipUnitIntValue = -1;
      unitsCount++;
      continue;
    }
    if (c < '0' || c > '9') {
      return false;
    }
    if (ipUnitIntValue == -1) ipUnitIntValue = 0;
    ipUnitIntValue = ipUnitIntValue * 10 + (c - '0');
  }
  if (ipUnitIntValue < 0 || ipUnitIntValue > 255) return false;
  if (unitsCount != 3) return false;
  return true;
}
~~~

å…ˆè¯´ç»“è®ºï¼Œç¬¬äºŒç§å®ç°æ–¹å¼æ›´ç¬¦åˆKISSåŸåˆ™ã€‚ç¬¬ä¸€ç§æ–¹å¼è™½ç„¶è¡Œæ•°æœ€å°‘ï¼Œä½†æ˜¯å®ƒä½¿ç”¨äº†å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚è€Œç¬¬ä¸‰ç§æ–¹å¼æ¯”ç¬¬äºŒç§ï¼Œå®ç°èµ·æ¥æ›´åŠ æœ‰éš¾åº¦ï¼Œå®¹æ˜“å‡ºç°bugã€‚

ä½†æ˜¯ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼Œç¬¬ä¸‰ç§è¦æ¯”ç¬¬äºŒç§å¥½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå·¥å…·ç±»çš„åŠŸèƒ½éƒ½æ¯”è¾ƒé€šç”¨å’Œå…¨é¢ï¼Œæ‰€ä»¥ï¼Œåœ¨ä»£ç å®ç°ä¸Šï¼Œéœ€è¦è€ƒè™‘å’Œå¤„ç†æ›´å¤šçš„ç»†èŠ‚ï¼Œæ‰§è¡Œæ•ˆç‡å°±ä¼šæœ‰æ‰€å½±å“ã€‚

ä¸è¿‡ï¼Œæœ€ç»ˆè¿˜æ˜¯é€‰æ‹©ç¬¬äºŒç§å®ç°æ–¹æ³•ã€‚å› ä¸ºç¬¬ä¸‰ç§å®é™…ä¸Šæ˜¯ä¸€ç§è¿‡åº¦ä¼˜åŒ–ã€‚é™¤éisValidIpAddress()å‡½æ•°æ˜¯å½±å“ç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆä»£ç ï¼Œå¦åˆ™ï¼Œè¿™æ ·ä¼˜åŒ–çš„æŠ•å…¥äº§å‡ºæ¯”å¹¶ä¸é«˜ï¼Œå¢åŠ äº†ä»£ç å®ç°çš„éš¾åº¦ã€ç‰ºç‰²äº†ä»£ç çš„å¯è¯»æ€§ï¼Œæ€§èƒ½ä¸Šçš„æå‡å´å¹¶ä¸æ˜æ˜¾ã€‚

### ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒKISSåŸåˆ™å—ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥çœ‹KMPç®—æ³•çš„å®ç°ï¼š

~~~java
// KMP algorithm: a, båˆ†åˆ«æ˜¯ä¸»ä¸²å’Œæ¨¡å¼ä¸²ï¼›n, måˆ†åˆ«æ˜¯ä¸»ä¸²å’Œæ¨¡å¼ä¸²çš„é•¿åº¦ã€‚
public static int kmp(char[] a, int n, char[] b, int m) {
  int[] next = getNexts(b, m);
  int j = 0;
  for (int i = 0; i < n; ++i) {
    while (j > 0 && a[i] != b[j]) { // ä¸€ç›´æ‰¾åˆ°a[i]å’Œb[j]
      j = next[j - 1] + 1;
    }
    if (a[i] == b[j]) {
      ++j;
    }
    if (j == m) { // æ‰¾åˆ°åŒ¹é…æ¨¡å¼ä¸²çš„äº†
      return i - m + 1;
    }
  }
  return -1;
}

// bè¡¨ç¤ºæ¨¡å¼ä¸²ï¼Œmè¡¨ç¤ºæ¨¡å¼ä¸²çš„é•¿åº¦
private static int[] getNexts(char[] b, int m) {
  int[] next = new int[m];
  next[0] = -1;
  int k = -1;
  for (int i = 1; i < m; ++i) {
    while (k != -1 && b[k + 1] != b[i]) {
      k = next[k];
    }
    if (b[k + 1] == b[i]) {
      ++k;
    }
    next[i] = k;
  }
  return next;
}
~~~

è¿™æ®µä»£ç å®Œå…¨ç¬¦åˆæˆ‘ä»¬åˆšæåˆ°çš„é€»è¾‘å¤æ‚ã€å®ç°éš¾åº¦å¤§ã€å¯è¯»æ€§å·®çš„ç‰¹ç‚¹ï¼Œä½†å®ƒå¹¶ä¸è¿åKISSåŸåˆ™ã€‚å› ä¸ºç”¨å¤æ‚çš„æ–¹æ³•æ¥è§£å†³æœ¬èº«å°±å¤æ‚çš„é—®é¢˜ï¼Œå¹¶ä¸è¿èƒŒKISSåŸåˆ™ã€‚åˆ«æŒ‡æœ›ç”¨å‡ ç™¾è¡Œä»£ç å®ç°ä¸€ä¸ªæ“ä½œç³»ç»Ÿ ğŸ¤£ã€‚

### YAGNI

> You Ainâ€™t Gonna Need It
>
> ä½ ä¸ä¼šéœ€è¦å®ƒ

è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼Œä¸è¦å»è®¾è®¡å½“å‰ç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼Œå³ä¸è¦åšè¿‡åº¦è®¾è®¡ã€‚

åœ¨å¼€å‘ä¸­ï¼Œæœ‰äº›åŒäº‹ä¸ºäº†é¿å…å¼€å‘ä¸­libraryåŒ…ç¼ºå¤±è€Œé¢‘ç¹åœ°ä¿®æ”¹Mavenæˆ–è€…Gradleé…ç½®æ–‡ä»¶ï¼Œæå‰å¾€é¡¹ç›®é‡Œå¼•å…¥å¤§é‡å¸¸ç”¨çš„libraryåŒ…ã€‚å®é™…ä¸Šï¼Œè¿™æ ·çš„åšæ³•ä¹Ÿæ˜¯è¿èƒŒYAGNIåŸåˆ™çš„ã€‚

YAGNIåŸåˆ™è·ŸKISSåŸåˆ™å¹¶éä¸€å›äº‹å„¿ã€‚KISSåŸåˆ™è®²çš„æ˜¯â€œå¦‚ä½•åšâ€çš„é—®é¢˜ï¼ˆå°½é‡ä¿æŒç®€å•ï¼‰ï¼Œè€ŒYAGNIåŸåˆ™è¯´çš„æ˜¯â€œè¦ä¸è¦åšâ€çš„é—®é¢˜ï¼ˆå½“å‰ä¸éœ€è¦çš„å°±ä¸è¦åšï¼‰ã€‚

## DRY

>Donâ€™t Repeat Yourself
>
>ä¸è¦é‡å¤è‡ªå·±ï¼ˆä¸è¦é‡å¤é€ è½®å­ï¼‰



## è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰



>Each unit should have only limited knowledge about other units: only units â€œcloselyâ€ related to the current unit. Or: Each unit should only talk to its friends; Donâ€™t talk to strangers.
>
>æ¯ä¸ªæ¨¡å—åªåº”è¯¥äº†è§£é‚£äº›ä¸å®ƒå…³ç³»å¯†åˆ‡çš„æ¨¡å—çš„æœ‰é™çŸ¥è¯†ã€‚æˆ–è€…è¯´ï¼Œæ¯ä¸ªæ¨¡å—åªå’Œè‡ªå·±çš„æœ‹å‹â€œè¯´è¯â€ï¼Œä¸å’Œé™Œç”Ÿäººâ€œè¯´è¯â€ã€‚



## å®æˆ˜ï¼šé’ˆå¯¹ä¸šåŠ¡ç³»ç»Ÿçš„å¼€å‘ï¼Œå¦‚ä½•åšéœ€æ±‚åˆ†æå’Œè®¾è®¡ï¼Ÿ



## å®æˆ˜ï¼šé’ˆå¯¹éä¸šåŠ¡çš„é€šç”¨æ¡†æ¶å¼€å‘ï¼Œå¦‚ä½•åšéœ€æ±‚åˆ†æå’Œè®¾è®¡ï¼Ÿ